<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"apeng.re","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.18.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="比赛时间: 5月16日-5月18日 终于,又一次来到了defcon的预选赛.仍然记得去年自闭了两天只做出来一道misc(锤地).今年仍然是令人自闭的一年.经过两晚奋战到四点的努力,总算做出3道(其实是2道)题.自然收获满满,也学到了很多有意思的东西.">
<meta property="og:type" content="article">
<meta property="og:title" content="2020 DEF CON quals 小记">
<meta property="og:url" content="http://apeng.re/2020/05/18/2020defcon-quals/index.html">
<meta property="og:site_name" content="Apeng&#39;s blog">
<meta property="og:description" content="比赛时间: 5月16日-5月18日 终于,又一次来到了defcon的预选赛.仍然记得去年自闭了两天只做出来一道misc(锤地).今年仍然是令人自闭的一年.经过两晚奋战到四点的努力,总算做出3道(其实是2道)题.自然收获满满,也学到了很多有意思的东西.">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://apeng.re/2020/05/18/2020defcon-quals/01.png">
<meta property="og:image" content="http://apeng.re/2020/05/18/2020defcon-quals/02.png">
<meta property="og:image" content="http://apeng.re/2020/05/18/2020defcon-quals/03.png">
<meta property="og:image" content="http://apeng.re/2020/05/18/2020defcon-quals/04.png">
<meta property="og:image" content="http://apeng.re/2020/05/18/2020defcon-quals/05.png">
<meta property="og:image" content="http://apeng.re/2020/05/18/2020defcon-quals/06.png">
<meta property="og:image" content="http://apeng.re/2020/05/18/2020defcon-quals/07.png">
<meta property="og:image" content="http://apeng.re/2020/05/18/2020defcon-quals/08.gif">
<meta property="og:image" content="http://apeng.re/2020/05/18/2020defcon-quals/09.gif">
<meta property="og:image" content="http://apeng.re/2020/05/18/2020defcon-quals/10.gif">
<meta property="og:image" content="http://apeng.re/2020/05/18/2020defcon-quals/11.gif">
<meta property="og:image" content="http://apeng.re/2020/05/18/2020defcon-quals/12.png">
<meta property="og:image" content="http://apeng.re/2020/05/18/2020defcon-quals/13.gif">
<meta property="og:image" content="http://apeng.re/2020/05/18/2020defcon-quals/14.gif">
<meta property="og:image" content="http://apeng.re/2020/05/18/2020defcon-quals/15.png">
<meta property="og:image" content="http://apeng.re/2020/05/18/2020defcon-quals/rom.png">
<meta property="og:image" content="http://apeng.re/2020/05/18/2020defcon-quals/16.jpg">
<meta property="og:image" content="http://apeng.re/2020/05/18/2020defcon-quals/17.jpg">
<meta property="og:image" content="http://apeng.re/2020/05/18/2020defcon-quals/19.jpg">
<meta property="og:image" content="http://apeng.re/2020/05/18/2020defcon-quals/18.jpg">
<meta property="og:image" content="http://apeng.re/2020/05/18/2020defcon-quals/20.jpg">
<meta property="og:image" content="http://apeng.re/2020/05/18/2020defcon-quals/22.jpg">
<meta property="og:image" content="http://apeng.re/2020/05/18/2020defcon-quals/21.jpg">
<meta property="og:image" content="http://apeng.re/2020/05/18/2020defcon-quals/23.jpg">
<meta property="og:image" content="http://apeng.re/2020/05/18/2020defcon-quals/24.jpg">
<meta property="og:image" content="http://apeng.re/2020/05/18/2020defcon-quals/25.jpg">
<meta property="og:image" content="http://apeng.re/2020/05/18/2020defcon-quals/26.jpg">
<meta property="og:image" content="http://apeng.re/2020/05/18/2020defcon-quals/27.jpg">
<meta property="og:image" content="http://apeng.re/2020/05/18/2020defcon-quals/28.jpg">
<meta property="og:image" content="http://apeng.re/2020/05/18/2020defcon-quals/29.jpg">
<meta property="og:image" content="http://apeng.re/2020/05/18/2020defcon-quals/30.jpg">
<meta property="og:image" content="http://apeng.re/2020/05/18/2020defcon-quals/31.jpg">
<meta property="og:image" content="http://apeng.re/2020/05/18/2020defcon-quals/32.jpg">
<meta property="og:image" content="http://apeng.re/2020/05/18/2020defcon-quals/33.jpg">
<meta property="og:image" content="http://apeng.re/2020/05/18/2020defcon-quals/34.jpg">
<meta property="og:image" content="http://apeng.re/2020/05/18/2020defcon-quals/35.jpg">
<meta property="og:image" content="http://apeng.re/2020/05/18/2020defcon-quals/36.jpg">
<meta property="og:image" content="http://apeng.re/2020/05/18/2020defcon-quals/37.jpg">
<meta property="og:image" content="http://apeng.re/2020/05/18/2020defcon-quals/38.jpg">
<meta property="og:image" content="http://apeng.re/2020/05/18/2020defcon-quals/39.jpg">
<meta property="article:published_time" content="2020-05-18T02:38:29.000Z">
<meta property="article:modified_time" content="2023-03-24T14:14:17.032Z">
<meta property="article:author" content="Apeng">
<meta property="article:tag" content="game of life">
<meta property="article:tag" content="maze">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://apeng.re/2020/05/18/2020defcon-quals/01.png">


<link rel="canonical" href="http://apeng.re/2020/05/18/2020defcon-quals/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://apeng.re/2020/05/18/2020defcon-quals/","path":"/2020/05/18/2020defcon-quals/","title":"2020 DEF CON quals 小记"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>2020 DEF CON quals 小记 | Apeng's blog</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="Apeng's blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Apeng's blog</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Reverse Everything</p>
      <img class="custom-logo-image" src="/uploads/custom-logo.png" alt="Apeng's blog">
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#re"><span class="nav-number">1.</span> <span class="nav-text">RE</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#fountain-ooo-reliving"><span class="nav-number">1.1.</span> <span class="nav-text">fountain-ooo-reliving</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BA%B7%E5%A8%81%E7%94%9F%E5%91%BD%E6%B8%B8%E6%88%8F"><span class="nav-number">1.1.1.</span> <span class="nav-text">康威生命游戏</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#quest-for-tetris-assembly"><span class="nav-number">1.1.2.</span> <span class="nav-text">Quest For Tetris Assembly</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#documentation"><span class="nav-number">1.1.3.</span> <span class="nav-text">Documentation</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8F%90%E5%8F%96rom%E5%B9%B6%E6%B1%82%E8%A7%A3"><span class="nav-number">1.1.4.</span> <span class="nav-text">提取ROM并求解</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#babymaze-mamamaze"><span class="nav-number">1.2.</span> <span class="nav-text">BabyMaze &amp; MamaMaze</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%B7%E5%AE%AB%E6%B8%B8%E6%88%8F"><span class="nav-number">1.2.1.</span> <span class="nav-text">迷宫游戏</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%BB%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90"><span class="nav-number">1.2.2.</span> <span class="nav-text">主程序分析</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#fork-%E4%B8%BB%E8%BF%9B%E7%A8%8B"><span class="nav-number">1.2.2.1.</span> <span class="nav-text">fork 主进程</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#fork-%E5%AD%90%E8%BF%9B%E7%A8%8B"><span class="nav-number">1.2.2.2.</span> <span class="nav-text">fork 子进程</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#breakpoint1"><span class="nav-number">1.2.2.3.</span> <span class="nav-text">breakpoint1</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#breakpoint2"><span class="nav-number">1.2.2.4.</span> <span class="nav-text">breakpoint2</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#breakpoint3-breakpoint4"><span class="nav-number">1.2.2.5.</span> <span class="nav-text">breakpoint3 &amp;&amp; breakpoint4</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#breakpoint5"><span class="nav-number">1.2.2.6.</span> <span class="nav-text">breakpoint5</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#breakpoint6"><span class="nav-number">1.2.2.7.</span> <span class="nav-text">breakpoint6</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%B7%E5%AE%AB%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90"><span class="nav-number">1.2.3.</span> <span class="nav-text">迷宫程序分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="nav-number">1.2.4.</span> <span class="nav-text">解决方案</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%9B%B4%E6%8E%A5%E4%BF%AE%E6%94%B9%E5%9D%90%E6%A0%87"><span class="nav-number">1.2.4.1.</span> <span class="nav-text">直接修改坐标</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9%E5%9C%B0%E5%9B%BE"><span class="nav-number">1.2.4.2.</span> <span class="nav-text">修改地图</span></a></li></ol></li></ol></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Apeng</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">31</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">59</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/Apeng7364" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Apeng7364" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:apeng622@gmail.com" title="E-Mail → mailto:apeng622@gmail.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/Apeng_7364" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;Apeng_7364" rel="noopener me" target="_blank"><i class="fab fa-twitter fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="/atom.xml" title="RSS → &#x2F;atom.xml" rel="noopener me"><i class="fa fa-rss fa-fw"></i></a>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/deed.zh" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/big/by_nc_nd.svg" alt="Creative Commons"></a>
  </div>

        </div>
      </div>
    </div>

    
    <div class="sidebar-inner sidebar-blogroll">
      <div class="links-of-blogroll animated">
        <div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i>
          链接
        </div>
        <ul class="links-of-blogroll-list">
            <li class="links-of-blogroll-item">
              <a href="/friends" title="&#x2F;friends">Friends</a>
            </li>
        </ul>
      </div>
    </div>
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://apeng.re/2020/05/18/2020defcon-quals/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Apeng">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Apeng's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="2020 DEF CON quals 小记 | Apeng's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          2020 DEF CON quals 小记
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-05-18 10:38:29" itemprop="dateCreated datePublished" datetime="2020-05-18T10:38:29+08:00">2020-05-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-03-24 22:14:17" itemprop="dateModified" datetime="2023-03-24T22:14:17+08:00">2023-03-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CTF-writeup/" itemprop="url" rel="index"><span itemprop="name">CTF writeup</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CTF-writeup/2020/" itemprop="url" rel="index"><span itemprop="name">2020</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p>比赛时间: 5月16日-5月18日</p>
<p>终于,又一次来到了defcon的预选赛.仍然记得去年自闭了两天只做出来一道misc(锤地).今年仍然是令人自闭的一年.经过两晚奋战到四点的努力,总算做出3道(其实是2道)题.自然收获满满,也学到了很多有意思的东西.</p>
<span id="more"></span>
<h1 id="re">RE</h1>
<h2 id="fountain-ooo-reliving">fountain-ooo-reliving</h2>
<blockquote>
<p>We have found the fountain OOO RElive. By discovering its secrets,
you will restart the game of life with a chance to do it all over again.
This challenge is in memory of John Conway (26 December 1937 – 11 April
2020).</p>
<p>Files:</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://s3.us-east-2.amazonaws.com/oooverflow-challs/b6abfff7ba2939b42644341f2ad307c3900382773999c67c7f8f5a67ae6179ad/fountain-ooo-relive">fountain-ooo-relive</a>
ee9ac9cde6915708df0ba814f07bdadcf009bb7dabdb2374d220bec4c8d26f22</li>
</ul>
</blockquote>
<p>文件下载下来是个文本,几万行:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[M2]</span><br><span class="line"># GOOOlly its the Fountain OOO REliving</span><br><span class="line">$$$$$$....**$....*$</span><br><span class="line">.****$*...*$....*$*..*$$$.*.....*$*.*...*$</span><br><span class="line">.....*$......*$.......*$</span><br><span class="line">*..*..*$*...*.*$.....*$</span><br><span class="line">4 1 2 3 4</span><br><span class="line">$$$$$$.....*$*...*.*$</span><br><span class="line">$$$$$$...*$..*.*$</span><br><span class="line">.*..*..*$..*.*$...*$</span><br><span class="line"># ......</span><br></pre></td></tr></table></figure>
<p>一开始我以为是misc,但这道题的分类是reverse</p>
<p>于是开始找资料吧.切入点应该在第一行的[M2]上,以及题目的描述里.根据描述,这道题跟生命游戏(game
of life)有关.经过各种关键词的谷歌,找到了一篇文章: <a target="_blank" rel="noopener" href="http://golly.sourceforge.net/Help/formats.html">Golly help: File
format</a>,文中描述的<strong>Macrocell
format</strong>和题目的文件一致.</p>
<h3 id="康威生命游戏">康威生命游戏</h3>
<p>康威生命游戏(元胞自动机)具体是什么呢?可以参考几个wiki:</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Conway&#39;s_Game_of_Life">https://en.wikipedia.org/wiki/Conway%27s_Game_of_Life</a></p>
<p>https://www.conwaylife.com/wiki/Main_Page</p>
</blockquote>
<p>总的来讲每个像素点根据周围格子的像素点的情况,会消亡/生存/繁殖,从而在时间维度上产生一系列变化.值得注意的是,元胞自动机是图灵完备的!</p>
<p>另外之前的De1CTF中,队友SJoshua出过一道生命游戏的题,所以还算有一点点了解.</p>
<p>一开始我还想手动画,后来impakho提醒Golly工具可以直接画出来并运行生命游戏(捂脸</p>
<h3 id="quest-for-tetris-assembly">Quest For Tetris Assembly</h3>
<p>用Golly打开之后我惊呆了,这竟然是一颗CPU!</p>
<figure>
<img src="/2020/05/18/2020defcon-quals/01.png" alt="01">
<figcaption aria-hidden="true">01</figcaption>
</figure>
<p>放大看看这些东西:</p>
<p>左边标注了ROM,每一个格子都存放了一个bit的数据.</p>
<figure>
<img src="/2020/05/18/2020defcon-quals/02.png" alt="02">
<figcaption aria-hidden="true">02</figcaption>
</figure>
<p>这里有ALU,可以看到9种opcode进入ALU进行运算</p>
<figure>
<img src="/2020/05/18/2020defcon-quals/03.png" alt="03">
<figcaption aria-hidden="true">03</figcaption>
</figure>
<p>右上方是RAM,每一个小格子里面是一个bit,一共是72*16,一个地址是16bit的宽度.</p>
<figure>
<img src="/2020/05/18/2020defcon-quals/04.png" alt="04">
<figcaption aria-hidden="true">04</figcaption>
</figure>
<p>中间是总线,连接着RAM,ROM,和ALU.</p>
<figure>
<img src="/2020/05/18/2020defcon-quals/05.png" alt="05">
<figcaption aria-hidden="true">05</figcaption>
</figure>
<p>如果继续放大,图里的每一个像素点并不是一个点,而是这样的结构,以开关ON这里为例:</p>
<figure>
<img src="/2020/05/18/2020defcon-quals/06.png" alt="06">
<figcaption aria-hidden="true">06</figcaption>
</figure>
<p>继续放大:</p>
<figure>
<img src="/2020/05/18/2020defcon-quals/07.png" alt="07">
<figcaption aria-hidden="true">07</figcaption>
</figure>
<p>每个单元中存放着大量的信息,有这样的最小单元携带.</p>
<p>我们让这个自动机动起来:</p>
<figure>
<img src="/2020/05/18/2020defcon-quals/08.gif" alt="08">
<figcaption aria-hidden="true">08</figcaption>
</figure>
<p>宏观上看,并且加快速度,8^5速度下,这些单元携带着数据动了起来!</p>
<figure>
<img src="/2020/05/18/2020defcon-quals/09.gif" alt="09">
<figcaption aria-hidden="true">09</figcaption>
</figure>
<p>先来到ROM取指令</p>
<figure>
<img src="/2020/05/18/2020defcon-quals/10.gif" alt="10">
<figcaption aria-hidden="true">10</figcaption>
</figure>
<figure>
<img src="/2020/05/18/2020defcon-quals/11.gif" alt="11">
<figcaption aria-hidden="true">11</figcaption>
</figure>
<p>仔细看的话根据ROM中的结构,走的“路径”是不一样的,3*4这种结构不会“右拐”,另外一种像横着的“中”字的结构会“右转”.</p>
<p>不过像这样的CPU,其实是能找到一样的资料的(感觉OOO也不会专门写这么一个东西过来,应该是有完整的实现再改改).impakho师傅最终找到这篇文章:<a target="_blank" rel="noopener" href="https://codegolf.stackexchange.com/questions/11880/build-a-working-game-of-tetris-in-conways-game-of-life">Build
a working game of Tetris in Conway's Game of
Life</a>,这里详细的介绍了这个的实现过程.</p>
<p>同时还找到了这种汇编语言的解释器:<a target="_blank" rel="noopener" href="http://play.starmaninnovations.com/qftasm/">QFTASM
Interpreter</a>.根据解释器和上面的文章,再加自己的调试,大概搞清楚了它在做什么.</p>
<p>首先依次取出每一条指令,根据图中标记的结构解析出opcode, arg 1 val, arg
1 mode, arg 2 val, arg2 mode, arg3 val, arg 3
mode.取指令的时候,根据ROM中的结构区分0和1.以opcode这里为例:</p>
<figure>
<img src="/2020/05/18/2020defcon-quals/12.png" alt="12">
<figcaption aria-hidden="true">12</figcaption>
</figure>
<p>这里就代表着0001,1号指令对应的是MLZ.在<a target="_blank" rel="noopener" href="http://play.starmaninnovations.com/qftasm/">QFTASM
Interpreter</a>这篇文章里还介绍了整个架构.MLZ指令的意思是小于零则移动.</p>
<blockquote>
<h3 id="documentation">Documentation</h3>
<p>QFTASM is a very simple version of Assembly developed for the <a target="_blank" rel="noopener" href="http://blog.phinotpi.com/2016/05/30/the-quest-for-tetris/">Quest
For Tetris</a> project. To use this interpreter, put your code in the
text box and click Set code to enable the flow control buttons. Run will
execute the instructions as quickly as possible, Step will execute one
instruction at a time, and Slow will execute instructions at a
user-defined rate.</p>
<p>Each instruction should be formatted like this:
<code>[number]: [INST] [arg1] [arg2] [arg3]</code>. Optional comments
are also allowed, and are denoted by a semicolon. Here is a list of
instructions along with their arguments:</p>
<ul>
<li><code>MNZ [test] [value] [dest]</code> – Move if not zero; sets
<code>[dest]</code> to <code>[value]</code> if <code>[test]</code> is
not zero.</li>
<li><code>MLZ [test] [value] [dest]</code> – Move if less than zero;
sets <code>[dest]</code> to <code>[value]</code> if <code>[test]</code>
is less than zero.</li>
<li><code>ADD [val1] [val2] [dest]</code> – Add; adds
<code>[val1]</code> to <code>[val2]</code> and stores the result in
<code>[dest]</code>.</li>
<li><code>SUB [val1] [val2] [dest]</code> – Subtract; subtracts
<code>[val2]</code> from <code>[val1]</code> and stores the result in
<code>[dest]</code>.</li>
<li><code>AND [val1] [val2] [dest]</code> – Bitwise AND; bitwise ANDs
together <code>[val1]</code> and <code>[val2]</code> and stores the
result in <code>[dest]</code>.</li>
<li><code>OR [val1] [val2] [dest]</code> – Bitwise OR; bitwise ORs
together <code>[val1]</code> and <code>[val2]</code> and stores the
result in <code>[dest]</code>.</li>
<li><code>XOR [val1] [val2] [dest]</code> – Bitwise XOR; bitwise XORs
together <code>[val1]</code> and <code>[val2]</code> and stores the
result in <code>[dest]</code>.</li>
<li><code>ANT [val1] [val2] [dest]</code> – Bitwise AND-NOT; bitwise
ANDs together <code>[val1]</code> and (NOT <code>[val2]</code>) and
stores the result in <code>[dest]</code>.</li>
<li><code>SL [val1] [val2] [dest]</code> – Shift left; shifts
<code>[val1]</code> left by <code>[val2]</code> bits and stores the
result in <code>[dest]</code>.</li>
<li><code>SRL [val1] [val2] [dest]</code> – Shift right (logical);
shifts <code>[val1]</code> right by <code>[val2]</code> bits and stores
the result in <code>[dest]</code>. Doesn't preserve sign.</li>
<li><code>SRA [val1] [val2] [dest]</code> – Shift right (arithmetic);
shifts <code>[val1]</code> right by <code>[val2]</code> bits and stores
the result in <code>[dest]</code>, while preserving sign.</li>
</ul>
<p>There are two formats for arguments: literal integers and references.
Integers may either positive or negative, with the negative ones
converted to two's complement (for example, -37 becomes 65573), and they
are limited to the range 0–65535 (16 bits). For references, the number
of dereferences is notated by one of <code>A, B, C</code>. For instance,
<code>A37</code> will be replaced with the data in address 37 at
execution time. <code>B37</code> will be replaced with the data in the
address given by the data in address 37, and likewise, with one more
level, for <code>C37</code>.</p>
<p>The first table shows the instructions and their machine code
equivalents. In the <strong>ASM</strong> column is the code exactly as
it appears in the input, sans comment. In the <strong>Opcode</strong>
column is the code for that command. <strong>Type</strong> refers to the
reference level, so <code>37</code> would have a type of <code>00</code>
and <code>A37</code> would have a type of <code>01</code>. Finally,
<strong>Location</strong> is just the value or address. Also, the
highlights show the next two instructions to be executed.</p>
<p>The second table shows the RAM bank, and I think the columns are
pretty self-explanatory. More RAM slots are added as needed (when an
instruction reads from or writes to an address outside of the current
range).</p>
<p>The three text boxes directly below can be used to set breakpoints.
Simply enter addresses separated by commas and/or spaces. Any of the
following will work: '<code>1,2,3</code>', '<code>1, 2, 3</code>',
'<code>1 2 3</code>'.</p>
<p>Regarding the direct write to RAM line, that address will be set to
that value when that address is read. Once that address is set, then the
value box is blanked. Further reads of the same address will not do
anything if the value box is blank. The accompanying checkbox is
self-explanatory, with the caveat that if a value is entered and then
the user resumes the interpreter, that address will be set to that value
the <em>next</em> time it is read.</p>
<p>For specifying which addresses to display, the format should be
something like <code>0 2-4 6</code>. Ranges of numbers are denoted by
<code>a-b</code> (inclusive), with no spaces on either side of the dash.
Separate numbers and ranges by commas and/or spaces.</p>
</blockquote>
<p>为验证我们的猜想,不一会我们便能在ALU附近看到一颗元胞(我不知道该怎么称呼这样的单元,电子吗?)来到了MLZ处(gif比较快,注意观察MLZ左侧的几个像素):</p>
<figure>
<img src="/2020/05/18/2020defcon-quals/13.gif" alt="13">
<figcaption aria-hidden="true">13</figcaption>
</figure>
<p>根据文档,RAM的0地址是PC,执行一条指令后会加一,我们观察RAM的0地址,不一会便会发现写1的操作:</p>
<p>图中从左往右的是读,从下往上的是写.可以看到最上方的bit被写为了1.</p>
<figure>
<img src="/2020/05/18/2020defcon-quals/14.gif" alt="14">
<figcaption aria-hidden="true">14</figcaption>
</figure>
<p>第一条指令<code>MLZ -1 44 43</code>的意思是将立即数44写进43地址,我们观察43地址,确实存放0x2C:</p>
<figure>
<img src="/2020/05/18/2020defcon-quals/15.png" alt="15">
<figcaption aria-hidden="true">15</figcaption>
</figure>
<p>当然,让GOLLY直接Generate的确能跑完整个程序,但是太慢了,而且查看内存也极其不方便.</p>
<p>观察一下ROM部分,由于0/1的差别比较大,可以截图下来对图像处理,写个脚本提取出ROM:</p>
<h3 id="提取rom并求解">提取ROM并求解</h3>
<p><strong>下方密恐慎入</strong>.</p>
<p>我们对一些特定的像素点进行识别,提取出01数据.再按照文档解析成指令,同时可以写个简单的解释器解释执行:</p>
<figure>
<img src="/2020/05/18/2020defcon-quals/rom.png" alt="rom">
<figcaption aria-hidden="true">rom</figcaption>
</figure>
<p>⚠️:此脚本只对本图有效</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image, ImageDraw</span><br><span class="line"><span class="keyword">from</span> struct <span class="keyword">import</span> pack, unpack</span><br><span class="line">img = Image.<span class="built_in">open</span>(<span class="string">&quot;./rom.png&quot;</span>)</span><br><span class="line">pixel = img.load()</span><br><span class="line">height = <span class="number">1270</span></span><br><span class="line">width = <span class="number">2554</span></span><br><span class="line">inst = []</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2549</span>, <span class="number">0</span>, -<span class="number">22</span>):</span><br><span class="line">	instruction = <span class="string">&quot;&quot;</span></span><br><span class="line">	<span class="keyword">for</span> y <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1261</span>, <span class="number">0</span>, -<span class="number">22</span>):</span><br><span class="line">		pix = pixel[x, y]</span><br><span class="line">		<span class="keyword">if</span> pix[<span class="number">0</span>]&lt;=<span class="number">128</span>:</span><br><span class="line">			instruction+= <span class="string">&quot;1&quot;</span></span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			instruction+= <span class="string">&quot;0&quot;</span></span><br><span class="line">	instruction = instruction[::-<span class="number">1</span>]</span><br><span class="line">	inst.append(instruction)</span><br><span class="line">	<span class="comment"># print(instruction)</span></span><br><span class="line"></span><br><span class="line">op = &#123;<span class="number">0</span>:<span class="string">&quot;MNZ&quot;</span>, <span class="number">1</span>:<span class="string">&quot;MLZ&quot;</span>, <span class="number">2</span>:<span class="string">&quot;ADD&quot;</span>, <span class="number">3</span>:<span class="string">&quot;SUB&quot;</span>, <span class="number">4</span>:<span class="string">&quot;AND&quot;</span>, <span class="number">5</span>:<span class="string">&quot;OR&quot;</span>, <span class="number">6</span>:<span class="string">&quot;XOR&quot;</span>, <span class="number">7</span>:<span class="string">&quot;ANT&quot;</span>, <span class="number">8</span>:<span class="string">&quot;SL&quot;</span>, <span class="number">9</span>:<span class="string">&quot;SRL&quot;</span>&#125;</span><br><span class="line">mode = &#123;<span class="number">0</span>:<span class="string">&quot;&quot;</span>, <span class="number">1</span>:<span class="string">&quot;A&quot;</span>, <span class="number">2</span>:<span class="string">&quot;B&quot;</span>, <span class="number">3</span>:<span class="string">&quot;C&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(inst)):</span><br><span class="line">	<span class="keyword">assert</span> <span class="built_in">len</span>(inst[i]) == <span class="number">58</span></span><br><span class="line">	arg3_mode = <span class="built_in">int</span>(inst[i][<span class="number">0</span>:<span class="number">2</span>], <span class="number">2</span>)</span><br><span class="line">	arg3_val = <span class="built_in">int</span>(inst[i][<span class="number">2</span>:<span class="number">18</span>], <span class="number">2</span>)</span><br><span class="line">	arg3_val = unpack(<span class="string">&quot;&lt;h&quot;</span>, pack(<span class="string">&quot;&lt;H&quot;</span>, arg3_val))[<span class="number">0</span>]</span><br><span class="line">	arg2_mode = <span class="built_in">int</span>(inst[i][<span class="number">18</span>:<span class="number">20</span>], <span class="number">2</span>)</span><br><span class="line">	arg2_val = <span class="built_in">int</span>(inst[i][<span class="number">20</span>:<span class="number">36</span>], <span class="number">2</span>)</span><br><span class="line">	arg2_val = unpack(<span class="string">&quot;&lt;h&quot;</span>, pack(<span class="string">&quot;&lt;H&quot;</span>, arg2_val))[<span class="number">0</span>]</span><br><span class="line">	arg1_mode = <span class="built_in">int</span>(inst[i][<span class="number">36</span>:<span class="number">38</span>], <span class="number">2</span>)</span><br><span class="line">	arg1_val = <span class="built_in">int</span>(inst[i][<span class="number">38</span>:<span class="number">54</span>], <span class="number">2</span>)</span><br><span class="line">	arg1_val = unpack(<span class="string">&quot;&lt;h&quot;</span>, pack(<span class="string">&quot;&lt;H&quot;</span>, arg1_val))[<span class="number">0</span>]</span><br><span class="line">	opcode = <span class="built_in">int</span>(inst[i][<span class="number">54</span>:<span class="number">58</span>], <span class="number">2</span>)</span><br><span class="line">	s = <span class="string">&quot;%d. %s %s%d %s%d %s%d&quot;</span>%(i, op[opcode], mode[arg1_mode], arg1_val, mode[arg2_mode], arg2_val, mode[arg3_mode], arg3_val)</span><br><span class="line">	<span class="built_in">print</span>(s)</span><br><span class="line">exit()</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0.</span> MLZ -<span class="number">1</span> <span class="number">44</span> <span class="number">43</span></span><br><span class="line"><span class="number">1.</span> XOR <span class="number">0</span> <span class="number">0</span> <span class="number">2</span></span><br><span class="line"><span class="number">2.</span> MLZ -<span class="number">1</span> <span class="number">25971</span> <span class="number">2</span></span><br><span class="line"><span class="number">3.</span> MLZ -<span class="number">1</span> <span class="number">14554</span> <span class="number">3</span></span><br><span class="line"><span class="number">4.</span> MLZ -<span class="number">1</span> <span class="number">22445</span> <span class="number">4</span></span><br><span class="line"><span class="number">5.</span> MLZ -<span class="number">1</span> <span class="number">25411</span> <span class="number">5</span></span><br><span class="line"><span class="number">6.</span> MLZ -<span class="number">1</span> <span class="number">3743</span> <span class="number">6</span></span><br><span class="line"><span class="number">7.</span> MLZ -<span class="number">1</span> <span class="number">13391</span> <span class="number">7</span></span><br><span class="line"><span class="number">8.</span> MLZ -<span class="number">1</span> <span class="number">12059</span> <span class="number">8</span></span><br><span class="line"><span class="number">9.</span> MLZ -<span class="number">1</span> <span class="number">2554</span> <span class="number">9</span></span><br><span class="line"><span class="number">10.</span> MLZ -<span class="number">1</span> <span class="number">15823</span> <span class="number">10</span></span><br><span class="line"><span class="number">11.</span> MLZ -<span class="number">1</span> <span class="number">5921</span> <span class="number">11</span></span><br><span class="line"><span class="number">12.</span> MLZ -<span class="number">1</span> <span class="number">18009</span> <span class="number">12</span></span><br><span class="line"><span class="number">13.</span> MLZ -<span class="number">1</span> <span class="number">14823</span> <span class="number">13</span></span><br><span class="line"><span class="number">14.</span> MLZ -<span class="number">1</span> <span class="number">4757</span> <span class="number">14</span></span><br><span class="line"><span class="number">15.</span> MLZ -<span class="number">1</span> <span class="number">7754</span> <span class="number">15</span></span><br><span class="line"><span class="number">16.</span> MLZ -<span class="number">1</span> <span class="number">22480</span> <span class="number">16</span></span><br><span class="line"><span class="number">17.</span> MLZ -<span class="number">1</span> <span class="number">8371</span> <span class="number">17</span></span><br><span class="line"><span class="number">18.</span> MLZ -<span class="number">1</span> <span class="number">12418</span> <span class="number">18</span></span><br><span class="line"><span class="number">19.</span> MLZ -<span class="number">1</span> <span class="number">22738</span> <span class="number">19</span></span><br><span class="line"><span class="number">20.</span> MLZ -<span class="number">1</span> <span class="number">16499</span> <span class="number">20</span></span><br><span class="line"><span class="number">21.</span> MLZ -<span class="number">1</span> <span class="number">7132</span> <span class="number">21</span></span><br><span class="line"><span class="number">22.</span> MLZ -<span class="number">1</span> <span class="number">22793</span> <span class="number">22</span></span><br><span class="line"><span class="number">23.</span> MLZ -<span class="number">1</span> <span class="number">22307</span> <span class="number">23</span></span><br><span class="line"><span class="number">24.</span> MLZ -<span class="number">1</span> <span class="number">12485</span> <span class="number">24</span></span><br><span class="line"><span class="number">25.</span> MLZ -<span class="number">1</span> <span class="number">7936</span> <span class="number">25</span></span><br><span class="line"><span class="number">26.</span> MLZ -<span class="number">1</span> <span class="number">26630</span> <span class="number">26</span></span><br><span class="line"><span class="number">27.</span> MLZ -<span class="number">1</span> <span class="number">15483</span> <span class="number">27</span></span><br><span class="line"><span class="number">28.</span> MLZ -<span class="number">1</span> <span class="number">6471</span> <span class="number">28</span></span><br><span class="line"><span class="number">29.</span> MLZ -<span class="number">1</span> <span class="number">1806</span> <span class="number">29</span></span><br><span class="line"><span class="number">30.</span> MLZ -<span class="number">1</span> <span class="number">22705</span> <span class="number">30</span></span><br><span class="line"><span class="number">31.</span> MLZ -<span class="number">1</span> <span class="number">25019</span> <span class="number">31</span></span><br><span class="line"><span class="number">32.</span> MLZ -<span class="number">1</span> <span class="number">16442</span> <span class="number">32</span></span><br><span class="line"><span class="number">33.</span> MLZ -<span class="number">1</span> <span class="number">5145</span> <span class="number">33</span></span><br><span class="line"><span class="number">34.</span> MLZ -<span class="number">1</span> <span class="number">15593</span> <span class="number">34</span></span><br><span class="line"><span class="number">35.</span> MLZ -<span class="number">1</span> <span class="number">23867</span> <span class="number">35</span></span><br><span class="line"><span class="number">36.</span> MLZ -<span class="number">1</span> <span class="number">23738</span> <span class="number">36</span></span><br><span class="line"><span class="number">37.</span> MLZ -<span class="number">1</span> <span class="number">14086</span> <span class="number">37</span></span><br><span class="line"><span class="number">38.</span> MLZ -<span class="number">1</span> <span class="number">23123</span> <span class="number">38</span></span><br><span class="line"><span class="number">39.</span> MLZ -<span class="number">1</span> <span class="number">0</span> <span class="number">39</span></span><br><span class="line"><span class="number">40.</span> XOR A1 -<span class="number">27179</span> <span class="number">39</span></span><br><span class="line"><span class="number">41.</span> SUB A39 A2 <span class="number">2</span></span><br><span class="line"><span class="number">42.</span> XOR A1 -<span class="number">14018</span> <span class="number">39</span></span><br><span class="line"><span class="number">43.</span> SUB A39 A3 <span class="number">3</span></span><br><span class="line"><span class="number">44.</span> XOR A1 -<span class="number">22549</span> <span class="number">39</span></span><br><span class="line"><span class="number">45.</span> SUB A39 A4 <span class="number">4</span></span><br><span class="line"><span class="number">46.</span> XOR A1 -<span class="number">27735</span> <span class="number">39</span></span><br><span class="line"><span class="number">47.</span> SUB A39 A5 <span class="number">5</span></span><br><span class="line"><span class="number">48.</span> XOR A1 -<span class="number">225</span> <span class="number">39</span></span><br><span class="line"><span class="number">49.</span> SUB A39 A6 <span class="number">6</span></span><br><span class="line"><span class="number">50.</span> XOR A1 -<span class="number">15190</span> <span class="number">39</span></span><br><span class="line"><span class="number">51.</span> SUB A39 A7 <span class="number">7</span></span><br><span class="line"><span class="number">52.</span> XOR A1 -<span class="number">8339</span> <span class="number">39</span></span><br><span class="line"><span class="number">53.</span> SUB A39 A8 <span class="number">8</span></span><br><span class="line"><span class="number">54.</span> XOR A1 -<span class="number">1415</span> <span class="number">39</span></span><br><span class="line"><span class="number">55.</span> SUB A39 A9 <span class="number">9</span></span><br><span class="line"><span class="number">56.</span> XOR A1 -<span class="number">12768</span> <span class="number">39</span></span><br><span class="line"><span class="number">57.</span> SUB A39 A10 <span class="number">10</span></span><br><span class="line"><span class="number">58.</span> XOR A1 -<span class="number">6243</span> <span class="number">39</span></span><br><span class="line"><span class="number">59.</span> SUB A39 A11 <span class="number">11</span></span><br><span class="line"><span class="number">60.</span> XOR A1 -<span class="number">18725</span> <span class="number">39</span></span><br><span class="line"><span class="number">61.</span> SUB A39 A12 <span class="number">12</span></span><br><span class="line"><span class="number">62.</span> XOR A1 -<span class="number">13743</span> <span class="number">39</span></span><br><span class="line"><span class="number">63.</span> SUB A39 A13 <span class="number">13</span></span><br><span class="line"><span class="number">64.</span> XOR A1 -<span class="number">7402</span> <span class="number">39</span></span><br><span class="line"><span class="number">65.</span> SUB A39 A14 <span class="number">14</span></span><br><span class="line"><span class="number">66.</span> XOR A1 -<span class="number">4444</span> <span class="number">39</span></span><br><span class="line"><span class="number">67.</span> SUB A39 A15 <span class="number">15</span></span><br><span class="line"><span class="number">68.</span> XOR A1 -<span class="number">22495</span> <span class="number">39</span></span><br><span class="line"><span class="number">69.</span> SUB A39 A16 <span class="number">16</span></span><br><span class="line"><span class="number">70.</span> XOR A1 -<span class="number">12017</span> <span class="number">39</span></span><br><span class="line"><span class="number">71.</span> SUB A39 A17 <span class="number">17</span></span><br><span class="line"><span class="number">72.</span> XOR A1 -<span class="number">16138</span> <span class="number">39</span></span><br><span class="line"><span class="number">73.</span> SUB A39 A18 <span class="number">18</span></span><br><span class="line"><span class="number">74.</span> XOR A1 -<span class="number">22234</span> <span class="number">39</span></span><br><span class="line"><span class="number">75.</span> SUB A39 A19 <span class="number">19</span></span><br><span class="line"><span class="number">76.</span> XOR A1 -<span class="number">20283</span> <span class="number">39</span></span><br><span class="line"><span class="number">77.</span> SUB A39 A20 <span class="number">20</span></span><br><span class="line"><span class="number">78.</span> XOR A1 -<span class="number">5054</span> <span class="number">39</span></span><br><span class="line"><span class="number">79.</span> SUB A39 A21 <span class="number">21</span></span><br><span class="line"><span class="number">80.</span> XOR A1 -<span class="number">22161</span> <span class="number">39</span></span><br><span class="line"><span class="number">81.</span> SUB A39 A22 <span class="number">22</span></span><br><span class="line"><span class="number">82.</span> XOR A1 -<span class="number">22641</span> <span class="number">39</span></span><br><span class="line"><span class="number">83.</span> SUB A39 A23 <span class="number">23</span></span><br><span class="line"><span class="number">84.</span> XOR A1 -<span class="number">16096</span> <span class="number">39</span></span><br><span class="line"><span class="number">85.</span> SUB A39 A24 <span class="number">24</span></span><br><span class="line"><span class="number">86.</span> XOR A1 -<span class="number">4238</span> <span class="number">39</span></span><br><span class="line"><span class="number">87.</span> SUB A39 A25 <span class="number">25</span></span><br><span class="line"><span class="number">88.</span> XOR A1 -<span class="number">26510</span> <span class="number">39</span></span><br><span class="line"><span class="number">89.</span> SUB A39 A26 <span class="number">26</span></span><br><span class="line"><span class="number">90.</span> XOR A1 -<span class="number">13059</span> <span class="number">39</span></span><br><span class="line"><span class="number">91.</span> SUB A39 A27 <span class="number">27</span></span><br><span class="line"><span class="number">92.</span> XOR A1 -<span class="number">5726</span> <span class="number">39</span></span><br><span class="line"><span class="number">93.</span> SUB A39 A28 <span class="number">28</span></span><br><span class="line"><span class="number">94.</span> XOR A1 -<span class="number">2182</span> <span class="number">39</span></span><br><span class="line"><span class="number">95.</span> SUB A39 A29 <span class="number">29</span></span><br><span class="line"><span class="number">96.</span> XOR A1 -<span class="number">22211</span> <span class="number">39</span></span><br><span class="line"><span class="number">97.</span> SUB A39 A30 <span class="number">30</span></span><br><span class="line"><span class="number">98.</span> XOR A1 -<span class="number">28099</span> <span class="number">39</span></span><br><span class="line"><span class="number">99.</span> SUB A39 A31 <span class="number">31</span></span><br><span class="line"><span class="number">100.</span> XOR A1 -<span class="number">20296</span> <span class="number">39</span></span><br><span class="line"><span class="number">101.</span> SUB A39 A32 <span class="number">32</span></span><br><span class="line"><span class="number">102.</span> XOR A1 -<span class="number">7012</span> <span class="number">39</span></span><br><span class="line"><span class="number">103.</span> SUB A39 A33 <span class="number">33</span></span><br><span class="line"><span class="number">104.</span> XOR A1 -<span class="number">12961</span> <span class="number">39</span></span><br><span class="line"><span class="number">105.</span> SUB A39 A34 <span class="number">34</span></span><br><span class="line"><span class="number">106.</span> XOR A1 -<span class="number">21059</span> <span class="number">39</span></span><br><span class="line"><span class="number">107.</span> SUB A39 A35 <span class="number">35</span></span><br><span class="line"><span class="number">108.</span> XOR A1 -<span class="number">21210</span> <span class="number">39</span></span><br><span class="line"><span class="number">109.</span> SUB A39 A36 <span class="number">36</span></span><br><span class="line"><span class="number">110.</span> XOR A1 -<span class="number">14493</span> <span class="number">39</span></span><br><span class="line"><span class="number">111.</span> SUB A39 A37 <span class="number">37</span></span><br><span class="line"><span class="number">112.</span> XOR A1 -<span class="number">21817</span> <span class="number">39</span></span><br><span class="line"><span class="number">113.</span> SUB A39 A38 <span class="number">38</span></span><br><span class="line"><span class="number">114.</span> MLZ -<span class="number">1</span> -<span class="number">2</span> <span class="number">0</span></span><br><span class="line"><span class="number">115.</span> MLZ <span class="number">0</span> <span class="number">0</span> <span class="number">0</span></span><br></pre></td></tr></table></figure>
<p>整个代码非常简单,只是在做一些异或和减法运算.</p>
<p>丢进在线的解释器可以调试,经过一通调试,发现RAM中的结果有些不同.</p>
<p>最后发现RAM1地址是有东西的,这里好坑.</p>
<p>最终得到的结果并不是flag.似乎整个程序也是在做固定的工作,每次运行的结果都一样,那么要怎么得到flag呢?</p>
<p>回过头来看一下题目描述:</p>
<blockquote>
<p>By discovering its secrets, you will restart the game of life with a
chance to do it all over again.</p>
</blockquote>
<p>找到什么secrets,再运行一遍就得到flag了.结合RAM1地址是有东西的,如果我们对他进行一些修改,计算出的结果也是不一样的.是否这个数据就是所谓的secrets.在上面的脚本基础上修改一下,爆破1地址的内容:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image, ImageDraw</span><br><span class="line"><span class="keyword">from</span> struct <span class="keyword">import</span> pack, unpack</span><br><span class="line">img = Image.<span class="built_in">open</span>(<span class="string">&quot;./rom.png&quot;</span>)</span><br><span class="line">pixel = img.load()</span><br><span class="line">height = <span class="number">1270</span></span><br><span class="line">width = <span class="number">2554</span></span><br><span class="line">inst = []</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2549</span>, <span class="number">0</span>, -<span class="number">22</span>):</span><br><span class="line">	instruction = <span class="string">&quot;&quot;</span></span><br><span class="line">	<span class="keyword">for</span> y <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1261</span>, <span class="number">0</span>, -<span class="number">22</span>):</span><br><span class="line">		pix = pixel[x, y]</span><br><span class="line">		<span class="keyword">if</span> pix[<span class="number">0</span>]&lt;=<span class="number">128</span>:</span><br><span class="line">			instruction+= <span class="string">&quot;1&quot;</span></span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			instruction+= <span class="string">&quot;0&quot;</span></span><br><span class="line">	instruction = instruction[::-<span class="number">1</span>]</span><br><span class="line">	inst.append(instruction)</span><br><span class="line">	<span class="comment"># print(instruction)</span></span><br><span class="line"></span><br><span class="line">op = &#123;<span class="number">0</span>:<span class="string">&quot;MNZ&quot;</span>, <span class="number">1</span>:<span class="string">&quot;MLZ&quot;</span>, <span class="number">2</span>:<span class="string">&quot;ADD&quot;</span>, <span class="number">3</span>:<span class="string">&quot;SUB&quot;</span>, <span class="number">4</span>:<span class="string">&quot;AND&quot;</span>, <span class="number">5</span>:<span class="string">&quot;OR&quot;</span>, <span class="number">6</span>:<span class="string">&quot;XOR&quot;</span>, <span class="number">7</span>:<span class="string">&quot;ANT&quot;</span>, <span class="number">8</span>:<span class="string">&quot;SL&quot;</span>, <span class="number">9</span>:<span class="string">&quot;SRL&quot;</span>&#125;</span><br><span class="line">mode = &#123;<span class="number">0</span>:<span class="string">&quot;&quot;</span>, <span class="number">1</span>:<span class="string">&quot;A&quot;</span>, <span class="number">2</span>:<span class="string">&quot;B&quot;</span>, <span class="number">3</span>:<span class="string">&quot;C&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">60000</span>,<span class="number">65535</span>):</span><br><span class="line">	asm = []</span><br><span class="line">	addr = [<span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">50</span>)]</span><br><span class="line">	addr[<span class="number">1</span>] = k</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(inst)):</span><br><span class="line">		<span class="keyword">assert</span> <span class="built_in">len</span>(inst[i]) == <span class="number">58</span></span><br><span class="line">		arg3_mode = <span class="built_in">int</span>(inst[i][<span class="number">0</span>:<span class="number">2</span>], <span class="number">2</span>)</span><br><span class="line">		arg3_val = <span class="built_in">int</span>(inst[i][<span class="number">2</span>:<span class="number">18</span>], <span class="number">2</span>)</span><br><span class="line">		arg3_val = unpack(<span class="string">&quot;&lt;h&quot;</span>, pack(<span class="string">&quot;&lt;H&quot;</span>, arg3_val))[<span class="number">0</span>]</span><br><span class="line">		arg2_mode = <span class="built_in">int</span>(inst[i][<span class="number">18</span>:<span class="number">20</span>], <span class="number">2</span>)</span><br><span class="line">		arg2_val = <span class="built_in">int</span>(inst[i][<span class="number">20</span>:<span class="number">36</span>], <span class="number">2</span>)</span><br><span class="line">		arg2_val = unpack(<span class="string">&quot;&lt;h&quot;</span>, pack(<span class="string">&quot;&lt;H&quot;</span>, arg2_val))[<span class="number">0</span>]</span><br><span class="line">		arg1_mode = <span class="built_in">int</span>(inst[i][<span class="number">36</span>:<span class="number">38</span>], <span class="number">2</span>)</span><br><span class="line">		arg1_val = <span class="built_in">int</span>(inst[i][<span class="number">38</span>:<span class="number">54</span>], <span class="number">2</span>)</span><br><span class="line">		arg1_val = unpack(<span class="string">&quot;&lt;h&quot;</span>, pack(<span class="string">&quot;&lt;H&quot;</span>, arg1_val))[<span class="number">0</span>]</span><br><span class="line">		opcode = <span class="built_in">int</span>(inst[i][<span class="number">54</span>:<span class="number">58</span>], <span class="number">2</span>)</span><br><span class="line">		s = <span class="string">&quot;%d. %s %s%d %s%d %s%d&quot;</span>%(i, op[opcode], mode[arg1_mode], arg1_val, mode[arg2_mode], arg2_val, mode[arg3_mode], arg3_val)</span><br><span class="line">		<span class="comment"># print(s)</span></span><br><span class="line">		<span class="keyword">if</span> opcode == <span class="number">1</span>:</span><br><span class="line">			addr[arg3_val] = arg2_val</span><br><span class="line">		<span class="keyword">elif</span> opcode == <span class="number">6</span>:</span><br><span class="line">			<span class="keyword">if</span> arg1_mode == <span class="number">0</span>:</span><br><span class="line">				addr[arg3_val] = (arg1_val ^ arg2_val) &amp; <span class="number">0xffff</span></span><br><span class="line">			<span class="keyword">elif</span> arg1_mode == <span class="number">1</span>:</span><br><span class="line">				addr[arg3_val] = (addr[arg1_val] ^ arg2_val) &amp; <span class="number">0xffff</span></span><br><span class="line">		<span class="keyword">elif</span> opcode == <span class="number">3</span>:</span><br><span class="line">			<span class="keyword">if</span> arg1_mode == <span class="number">1</span>:</span><br><span class="line">				addr[arg3_val] = (addr[arg1_val] - addr[arg2_val]) &amp; <span class="number">0xffff</span></span><br><span class="line">	p = <span class="literal">True</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> addr[<span class="number">2</span>:<span class="number">39</span>]:</span><br><span class="line">		<span class="keyword">if</span> i&lt;<span class="number">0x20</span> <span class="keyword">or</span> i &gt;= <span class="number">0x7f7f</span>:</span><br><span class="line">			p = <span class="literal">False</span></span><br><span class="line">	<span class="keyword">if</span> p == <span class="literal">True</span>:</span><br><span class="line">		<span class="built_in">print</span>(k)</span><br><span class="line">		<span class="built_in">print</span>(<span class="built_in">bytes</span>(addr[<span class="number">2</span>:<span class="number">39</span>]))</span><br></pre></td></tr></table></figure>
<p>最终在61463的地方发现了flag:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">61463</span><br><span class="line">b&#x27;OOO&#123;in_this_life___youre_on_your_own&#125;&#x27;</span><br></pre></td></tr></table></figure>
<h2 id="babymaze-mamamaze">BabyMaze &amp; MamaMaze</h2>
<blockquote>
<p>The flag is on the wings of the flying plane. It is possible to get
the flag without instrumenting or modifying the binary. Tested on Ubuntu
16.04, Ubuntu 18.04, and Ubuntu 20.04. You should use a system able to
run the game at approximately 60 fps. It requires: sudo apt-get install
freeglut3</p>
<ul>
<li>babymaze.challenges.ooo 7777</li>
</ul>
<p>Files:</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://s3.us-east-2.amazonaws.com/oooverflow-challs/626c9621bbdac5aaf0552b9e25bc37db88bcd5f8d2f1d106004961192cd366f1/BabyMaze">BabyMaze</a>
4d7aabfb62d46ea98379254a62023f178c1922c0908f3ff19634ca8c22f97cef</li>
</ul>
</blockquote>
<p>MamaMaze和BabyMaze没太大区别,只是第二张地图改的更大了.我这里的做法都一样.</p>
<h3 id="迷宫游戏">迷宫游戏</h3>
<p>按照题目描述,这是个迷宫挑战,需要freeglut.看到这个我就回想起了上学期的计算机图形学以及OpenGL...</p>
<p>运行一下是个3D的迷宫游戏,应该是用OpenGL实现的:</p>
<figure>
<img src="/2020/05/18/2020defcon-quals/16.jpg" alt="16">
<figcaption aria-hidden="true">16</figcaption>
</figure>
<p>运行的时候命令行参数要附带题目中的IP和PORT</p>
<p>摸索一下操作,WASD移动,R重置,Q退出,ZX左右旋转视角.鼠标也能切换事业,但是可能代码有问题,不是正常的第一人称视角那种切换,而是根据鼠标位置上下左右移动,操作极其反人类...</p>
<blockquote>
<p>Connecting to babymaze.challenges.ooo 7777... Connected! Solving
POW... done!</p>
<p>Hello! Welcome to BabyMaze Press Q to quit</p>
<p>First of all, you have to find the computer!</p>
</blockquote>
<p>根据命令行的提示,先要找到一个<code>computer</code></p>
<p>玩一下很快就能找到第一个目标(这条路我闭着眼睛都快能走了,谁能想象这两天我调试了多少次...</p>
<figure>
<img src="/2020/05/18/2020defcon-quals/17.jpg" alt="17">
<figcaption aria-hidden="true">17</figcaption>
</figure>
<p>到达后:</p>
<blockquote>
<p>Good job, you found the computer! Now select your next maze (use your
keyboard)</p>
</blockquote>
<p>键盘选择下一个地图,只有1和2可用.我测试一直用的1</p>
<blockquote>
<p>1 Now find the yellow box, you have 8 seconds! Too Slow!</p>
</blockquote>
<p>需要在8秒之内找到yellow
box,这是这道题的核心,也是卡了我一天的地方...</p>
<p>摸清功能,接下来开始逆向</p>
<h3 id="主程序分析">主程序分析</h3>
<h4 id="fork-主进程">fork 主进程</h4>
<p>fork之后,主进程校验环境变量,不能有LD_开头.</p>
<p>之后连接远程服务器,发送1,经过POW后,服务器会回一些数据和checksum.</p>
<p>接下来通过ptrace调试子进程,只接受int
3断点(wstatus的高8bit的值为5)</p>
<p>根据触发断点的次数,有不同的行为,一共捕获6次断点.</p>
<figure>
<img src="/2020/05/18/2020defcon-quals/19.jpg" alt="19">
<figcaption aria-hidden="true">19</figcaption>
</figure>
<h4 id="fork-子进程">fork 子进程</h4>
<p>fork之后,子进程读取文件中第二个ELF头,解密elf,新建memfd后拷贝过去,然后execv运行该elf,同时命令行参数为主进程的一个地址<code>93824994345264</code>(为了方便调试,我把ALSR关闭了,每次这个地址相同).这个地址初始存的是0.</p>
<figure>
<img src="/2020/05/18/2020defcon-quals/18.jpg" alt="18">
<figcaption aria-hidden="true">18</figcaption>
</figure>
<p>运行后可以把/proc/pid/exe拷贝出来,获取子进程执行的elf.</p>
<p>游戏进程是实际进行迷宫游戏的部分,具体是用OpenGL实现的,如果写过OpenGL的话会对这里比较熟悉.</p>
<p>可以直接调试这个elf,注意要正确的传递参数.全局搜int
3可以找到断点在哪里.也可以调试起来触发trap信号.</p>
<p>整体的思路其实比较简单,找到8秒限制的位置,想办法破除.但实际上操作起来比较麻烦,需要找到合适方法.</p>
<p>先理一边游戏流程,找到合适突破口,我们可以调试主进程+调试游戏进程,来搞清楚整个程序在做什么.</p>
<h4 id="breakpoint1">breakpoint1</h4>
<p>先调试主进程,在wait后下断,查看每一次断点的捕获:</p>
<p>第一次断下来后,使用PRACE_PEEKDATA,对0x401000-0x413000的地方做循环异或,校验此处的结果,存进<code>check_sum1</code>.<code>check_sum1</code>在后面用到.显然这里是阻止我们patch游戏进程.</p>
<p>然后从0x401000开始遍历,找到第一个全是nop的地方,我们通过调试可以拿到这个地址是<code>405DEE</code>,然后把这里开始的0xd0个数据patch成之前服务器发送的数据.</p>
<figure>
<img src="/2020/05/18/2020defcon-quals/20.jpg" alt="20">
<figcaption aria-hidden="true">20</figcaption>
</figure>
<p>所以第一个断点作用是校验子进程401000-413000的完整性,并修改代码.</p>
<h4 id="breakpoint2">breakpoint2</h4>
<p>继续调试,触发第二个breakpoint.</p>
<p>先从0x610000开始搜索0xFFEEDDCCBBAA0099,搜到的地址存下来做<code>key2_addr</code>.经过调试/静态搜索不难发现是<code>613498</code>.<code>613490</code>这个地址开始的16个字节的数据非常关键,是一个解密密钥.整个程序都在围绕这个解密密钥进行.初始化为11223344556677889900aabbccddeeff.</p>
<figure>
<img src="/2020/05/18/2020defcon-quals/22.jpg" alt="22">
<figcaption aria-hidden="true">22</figcaption>
</figure>
<p>然后这里又一次对401000-413000的数据进行校验.注意此时一部分代码已被修改,校验的是修改完的代码.然后将key的后8字节修改成checksum1
^ checksum2 ^ key2.</p>
<figure>
<img src="/2020/05/18/2020defcon-quals/21.jpg" alt="21">
<figcaption aria-hidden="true">21</figcaption>
</figure>
<h4 id="breakpoint3-breakpoint4">breakpoint3 &amp;&amp; breakpoint4</h4>
<p>触发第三个断点时,创建一个线程执行线程函数:</p>
<figure>
<img src="/2020/05/18/2020defcon-quals/23.jpg" alt="23">
<figcaption aria-hidden="true">23</figcaption>
</figure>
<p>线程函数:</p>
<p>这里修改一个变量,然后sleep10秒,然后判定pid1 和
pid2是否相等(在检验完环境变量后会将这两个变量都赋值为子进程pid),相等会kill掉子进程</p>
<figure>
<img src="/2020/05/18/2020defcon-quals/24.jpg" alt="24">
<figcaption aria-hidden="true">24</figcaption>
</figure>
<p>对pid2查找引用,在第四个断点用到:</p>
<p>第四次触发断点时,会将pid2改为-1.也就是说,我们必须要在10秒内触发第4个断点,不然直接kill.这里是一处时间校验.</p>
<figure>
<img src="/2020/05/18/2020defcon-quals/25.jpg" alt="25">
<figcaption aria-hidden="true">25</figcaption>
</figure>
<h4 id="breakpoint5">breakpoint5</h4>
<p>第五个断点,先对main开始的数据做校验.结束的条件是指针的内容和<code>unk_555555758130</code>一样.而这里开始存的内容是0x1111111122222222.代码段中并没有0x1111111122222222的数据,光看这里指针p指向的内容永远不会为0x1111111122222222,最终跑到当前Segment以外,然后触发异常gg.</p>
<p>当然程序能够正常运行,所以还有其他的操作,我们后面再看(如果对<code>unk_555555758130</code>查找引用,会发现子进程的命令行参数刚好是这个地址,所以可以猜想在子进程里对这个数据做了一些事情)</p>
<figure>
<img src="/2020/05/18/2020defcon-quals/26.jpg" alt="26">
<figcaption aria-hidden="true">26</figcaption>
</figure>
<p>校验完主进程的数据后,又一次连接远程服务器,发送2,然后POW,然后peak子进程中的16字节的key,发送给服务器,服务器会16个字节,在poke道子进程上.(注意这里goto
LABEL_37后还有ptrace,所以16个字节都写进去了)</p>
<figure>
<img src="/2020/05/18/2020defcon-quals/27.jpg" alt="27">
<figcaption aria-hidden="true">27</figcaption>
</figure>
<h4 id="breakpoint6">breakpoint6</h4>
<p>第6次断点,获取key的前8字节,乘以mul_value后写回去,然后后面又peek
key中的16字节,只是peek并没有poke.</p>
<figure>
<img src="/2020/05/18/2020defcon-quals/28.jpg" alt="28">
<figcaption aria-hidden="true">28</figcaption>
</figure>
<h3 id="迷宫程序分析">迷宫程序分析</h3>
<p>dump下来exe后,可以分析迷宫程序了.</p>
<p>可以结合调试分析.注意breakpoint1中修改了游戏进程的代码,所以运行到第一个breakpoint时要手动修改(或者提前patch好)</p>
<p>如果熟悉OpenGL的话,再逆向可能会轻松一点,实际影响不太大.整个程序比较大,有些细节没有逆完,一边逆一边遇到问题一边总结.</p>
<p>整个都逆下来显然工作量太大了,我们只能调重点的地方逆</p>
<p>freeglut使用<code>glutKeyboardFunc</code>函数设置键盘回调函数,可以看到按下不同按键的操作,只是将按键暂存起来.同时发现还有几个按键,h,
p, f,
v.可以进入游戏看看这些的功能,f和v暂时用不到,h是记录历史,p是查看历史.</p>
<p><code>glutIdleFunc</code>设置<code>Idle</code>函数.具体的细节忘了,大概是每绘制一帧的时候都会调用它.Idle函数中的</p>
<p><code>sub_406380</code>函数是主体部分,内容非常多,包含了大部分游戏逻辑的内容.</p>
<p>这里判定坐标是否到了computer的位置,computer坐标为(-45, 85)</p>
<figure>
<img src="/2020/05/18/2020defcon-quals/29.jpg" alt="29">
<figcaption aria-hidden="true">29</figcaption>
</figure>
<p>找到后,游戏提示选择地图.测试中只有1和2可以选.我一直选的是1.</p>
<p>选完1后,又fork了一个子进程,去attach主进程(pid在最开头通过getppid获得),peek的地址是命令行参数传过来的地址,把它修改为0x9090909090909090结合上文breakpoint5中的动作,也就解释了为什么之前在breakpoint5校验main时那个不会无限往后校验.这里将变量修改为9090909090909090后,主进程check
main函数时遇到9090909090909090会停下来.在main下面看一看,果然找到了一大片nop.也就是说,这里实际校验的是这一部分的内容.</p>
<figure>
<img src="/2020/05/18/2020defcon-quals/30.jpg" alt="30">
<figcaption aria-hidden="true">30</figcaption>
</figure>
<p>我们运行起来,走到computer后,ps查看一下进程也能发现它的子进程:</p>
<figure>
<img src="/2020/05/18/2020defcon-quals/31.jpg" alt="31">
<figcaption aria-hidden="true">31</figcaption>
</figure>
<p>由于一个进程只能有一个Tracer,所以我们调试主进程的话,子进程就不能对这里修改了.所以我们在调试的时候要手动修改.</p>
<p>继续往下,到字符串<code>Too slow</code>附近可以看到另一处时间校验:</p>
<figure>
<img src="/2020/05/18/2020defcon-quals/32.jpg" alt="32">
<figcaption aria-hidden="true">32</figcaption>
</figure>
<p>这里的time_start在按下数字1后记录.</p>
<p>校验迷宫的逻辑:</p>
<p>map位于bss段,在main开头被从rdata段拷贝过来.经过改过的sha256和aes后和签名校验.</p>
<figure>
<img src="/2020/05/18/2020defcon-quals/33.jpg" alt="33">
<figcaption aria-hidden="true">33</figcaption>
</figure>
<p>观察迷宫数据,不难猜出1是墙,0是走道儿:</p>
<figure>
<img src="/2020/05/18/2020defcon-quals/34.jpg" alt="34">
<figcaption aria-hidden="true">34</figcaption>
</figure>
<p>如果成功抵达yellow
box,就可以飞了.使用fvzx更改视野,提示flag在飞机翅膀上.</p>
<p>从选择迷宫开始,到飞到天上一定高度会触发几次断点,最后一次触发断点后会用之前提到的key解密一段密文,如果开头四个字符为GOOD的话说明解密正确,剩下部分会是真正flag的图片,否则显示的是一个cheater!的图片.</p>
<figure>
<img src="/2020/05/18/2020defcon-quals/35.jpg" alt="35">
<figcaption aria-hidden="true">35</figcaption>
</figure>
<p>对key查找引用我们会发现有一大堆位置都在修改key:</p>
<figure>
<img src="/2020/05/18/2020defcon-quals/36.jpg" alt="36">
<figcaption aria-hidden="true">36</figcaption>
</figure>
<p>其中有一个地方是线程函数,里面还有对时间的校验</p>
<p>由于这里是用的是系统调用获取时间,所以反编译不太好,我们看汇编代码.</p>
<figure>
<img src="/2020/05/18/2020defcon-quals/37.jpg" alt="37">
<figcaption aria-hidden="true">37</figcaption>
</figure>
<p>大致逻辑是第三步之前一直sleep.第三步时,先通过系统调用获取时间,再循环睡眠.一旦时间差高于9秒,会将<code>DBED58</code>开始的数据无限循环异或0xffeeddcc11223344.那么必然会触发异常然后gg,除非9秒内进入第四步.</p>
<figure>
<img src="/2020/05/18/2020defcon-quals/38.jpg" alt="38">
<figcaption aria-hidden="true">38</figcaption>
</figure>
<h3 id="解决方案">解决方案</h3>
<p>我一开始就做歪了,卡了非常久.我一开始想延长8秒的时间限制,进行了大量操作patch主程序和游戏程序,最终确实可以解除8秒限制,但算出来的key总是不对.程序中有大量对key的修改,环环相扣,一个地方错了最终的key也会错.尽管我以为所有的校验都是对的,还是有些地方没处理好,导致key计算错误.</p>
<p>由于没有成功我就不介绍这种方法的具体操作了.</p>
<h4 id="直接修改坐标">直接修改坐标</h4>
<p>这是我解题时的做法.一开始想改时间,后面尝试了hook
time函数,确实使得一个time校验失效了.但是还是计算不出来.卡了很久后想能不能hook
libc后在libc里面直接改个坐标,传送到终点.</p>
<p>首先经过调试与分析,知道<code>DC0588</code>的指针指向跟位置相关的结构体.我们在调试时查看这里的数据:</p>
<figure>
<img src="/2020/05/18/2020defcon-quals/39.jpg" alt="39">
<figcaption aria-hidden="true">39</figcaption>
</figure>
<p>经过测试,四组坐标都要进行修改才能真正进行移动.</p>
<p>那我们的目标就就是想办法运行时修改坐标.</p>
<p>经过一通操作,我想到可以hook 按下Q后的exit函数.不过hook
exit的问题是exit是不会返回的,所以要写段shellcode返回到正确的地址,调试时计算一下偏移即可.在末尾加个类似这样的shellcode:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">asm</span>(<span class="string">&quot;leave\npop %rax\nsub $620, %rax\npush %rax\nret&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>接下来的问题是,由于程序会校验LD_PRELOAD,所以要想办法绕过这个限制.</p>
<p>我的解决方案是,hook开头的setvbuf函数,将代码中的校验修改掉,经过检验后,在在一个合适的地方hook,把代码修改回去(过check
sum).这里利用的是puts函数,在输出<code>done!</code>和<code>Hello!</code>的时候hook.</p>
<p>然后修改一下elf的代码段权限,改成RWX(不知道为啥用mprotect失败了).</p>
<blockquote>
<p>那么能hook了其实可以干很多事.比如hook ptrace来监视对key的修改等等</p>
</blockquote>
<p>具体的poc如下:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;dlfcn.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="title function_">int</span><span class="params">(*Setvbuf)</span><span class="params">(FILE* , <span class="type">char</span> *, <span class="type">int</span>, <span class="type">size_t</span>)</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="title function_">int</span><span class="params">(*Puts)</span><span class="params">(<span class="type">const</span> <span class="type">char</span>*)</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="title function_">void</span><span class="params">(*Exit)</span><span class="params">(<span class="type">int</span>)</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">setvbuf</span><span class="params">(FILE *stream, <span class="type">char</span> *buf, <span class="type">int</span> mode, <span class="type">size_t</span> size)</span> &#123;</span><br><span class="line">    <span class="type">static</span> <span class="type">void</span> *handle = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="type">static</span> Setvbuf org_setvbuf = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">if</span> (!handle) &#123;</span><br><span class="line">        handle = dlopen(<span class="string">&quot;libc.so.6&quot;</span>, RTLD_LAZY);</span><br><span class="line">        org_setvbuf = (Setvbuf)dlsym(handle, <span class="string">&quot;setvbuf&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    org_setvbuf(stream, buf, mode, size);</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> *p = (<span class="type">unsigned</span> <span class="type">char</span> *)<span class="number">0x000055555555596a</span>;</span><br><span class="line">    <span class="type">void</span> *a = (<span class="type">void</span> *)<span class="number">0x0000555555555960</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>, *p);</span><br><span class="line">    *p = <span class="string">&#x27;F&#x27;</span>;</span><br><span class="line">    p = (<span class="type">unsigned</span> <span class="type">char</span> *)<span class="number">0x00005555555550E1</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>, *p);</span><br><span class="line">    *p = <span class="string">&#x27;F&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">puts</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *s)</span> &#123;</span><br><span class="line">    <span class="type">static</span> <span class="type">void</span> *handle = <span class="literal">NULL</span>;</span><br><span class="line">        <span class="type">static</span> Puts org_puts = <span class="literal">NULL</span>;</span><br><span class="line">        <span class="keyword">if</span> (!handle) &#123;</span><br><span class="line">                handle = dlopen(<span class="string">&quot;libc.so.6&quot;</span>, RTLD_LAZY);</span><br><span class="line">                org_puts = (Puts)dlsym(handle, <span class="string">&quot;puts&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">strcmp</span>(s, <span class="string">&quot;done!&quot;</span>) || !(<span class="built_in">strcmp</span>(s, <span class="string">&quot;Hello!&quot;</span>)))</span><br><span class="line">    &#123;</span><br><span class="line">        org_puts(<span class="string">&quot;hack puts&quot;</span>);</span><br><span class="line">        <span class="type">unsigned</span> <span class="type">char</span> *p = (<span class="type">unsigned</span> <span class="type">char</span> *)<span class="number">0x000055555555596a</span>;</span><br><span class="line">            <span class="type">void</span> *a = (<span class="type">void</span> *)<span class="number">0x0000555555555960</span>;</span><br><span class="line">            *p = <span class="string">&#x27;L&#x27;</span>;</span><br><span class="line">            p = (<span class="type">unsigned</span> <span class="type">char</span> *)<span class="number">0x00005555555550E1</span>;</span><br><span class="line">            *p = <span class="string">&#x27;L&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> org_puts(s);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">exit</span><span class="params">(<span class="type">int</span> status)</span> &#123;</span><br><span class="line">    <span class="type">static</span> <span class="type">void</span> *handle = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="type">static</span> Exit org_exit = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">if</span> (!handle) &#123;</span><br><span class="line">        handle = dlopen(<span class="string">&quot;libc.so.6&quot;</span>, RTLD_LAZY);</span><br><span class="line">        org_exit = (Exit)dlsym(handle, <span class="string">&quot;exit&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (status == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="type">int</span> *p = (<span class="type">int</span>*)<span class="number">0x00000000006134C0</span>;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;decrypt: %x\n&quot;</span>, *p);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">static</span> <span class="type">int</span> cnt = <span class="number">0</span>;</span><br><span class="line">    <span class="type">void</span> *location = (<span class="type">void</span> *)<span class="number">0x000000000DC0588</span>;</span><br><span class="line">    <span class="type">double</span> *a = *(<span class="type">double</span> **)location;</span><br><span class="line">    <span class="comment">//printf()</span></span><br><span class="line">    <span class="keyword">if</span> (cnt == <span class="number">0</span>) &#123;</span><br><span class="line">        a[<span class="number">2</span>] = <span class="number">-65.0</span>;</span><br><span class="line">        a[<span class="number">22</span>] = <span class="number">-65.0</span>;</span><br><span class="line">        a[<span class="number">30</span>] = <span class="number">-65.0</span>;</span><br><span class="line">        a[<span class="number">50</span>] = <span class="number">-65.0</span>;</span><br><span class="line">        a[<span class="number">4</span>] = <span class="number">90.0</span>;</span><br><span class="line">        a[<span class="number">24</span>] = <span class="number">90.0</span>;</span><br><span class="line">        a[<span class="number">32</span>] = <span class="number">90.0</span>;</span><br><span class="line">        a[<span class="number">52</span>] = <span class="number">90.0</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (cnt == <span class="number">1</span>) &#123;</span><br><span class="line">        a[<span class="number">2</span>] = <span class="number">120.0</span>;</span><br><span class="line">        a[<span class="number">22</span>] = <span class="number">120.0</span>;</span><br><span class="line">        a[<span class="number">30</span>] = <span class="number">120.0</span>;</span><br><span class="line">        a[<span class="number">50</span>] = <span class="number">120.0</span>;</span><br><span class="line">        a[<span class="number">4</span>] = <span class="number">140.0</span>;</span><br><span class="line">        a[<span class="number">24</span>] = <span class="number">140.0</span>;</span><br><span class="line">        a[<span class="number">32</span>] = <span class="number">140.0</span>;</span><br><span class="line">        a[<span class="number">52</span>] = <span class="number">140.0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    cnt += <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">asm</span>(<span class="string">&quot;leave\npop %rax\nsub $620, %rax\npush %rax\nret&quot;</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//gcc -fPIC preload.c -shared -o preload.so -ldl</span></span><br><span class="line"><span class="comment">//LD_PRELOAD=./preload.so ./BabyMaze_hook babymaze.challenges.ooo 7777</span></span><br></pre></td></tr></table></figure>
<p>另外,运行时直接修改/proc/pid/mem应该也可以修改坐标,但我还没试过.这种方法就不用管LD_PRELOAD了.</p>
<h4 id="修改地图">修改地图</h4>
<p>这种方法是赛后和pizza交流,pizza用的.</p>
<p>之前提到,第二部分的地图会被保存到bss上,选完地图后会进行校验.如果我们直接将地图的每一个格子都改成yello
box,就可以在8秒内到达了.而且bss段在程序校验的范围之外</p>
<p>由于有签名校验,我们可以先调试,修改地图后从程序中拿修改过的地图的签名,然后在写/proc/pid/mem.</p>

    </div>

    
    
    

    <footer class="post-footer">
          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>本文作者： </strong>Apeng
  </li>
  <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="http://apeng.re/2020/05/18/2020defcon-quals/" title="2020 DEF CON quals 小记">http://apeng.re/2020/05/18/2020defcon-quals/</a>
  </li>
  <li class="post-copyright-license">
      <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/deed.zh" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-ND</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

          <div class="post-tags">
              <a href="/tags/game-of-life/" rel="tag"># game of life</a>
              <a href="/tags/maze/" rel="tag"># maze</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2020/03/15/2020confidence/" rel="prev" title="2020 confidence">
                  <i class="fa fa-angle-left"></i> 2020 confidence
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2020/05/24/2020GKCTF/" rel="next" title="2020 GKCTF writeup">
                  2020 GKCTF writeup <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2023</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Apeng</span>
  </div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

  <a href="https://github.com/Apeng7364" class="github-corner" title="在 GitHub 上关注我" aria-label="在 GitHub 上关注我" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script>

  






  




  

  <script class="next-config" data-name="enableMath" type="application/json">false</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>



</body>
</html>
