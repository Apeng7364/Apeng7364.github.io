<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha256-CTSx/A06dm1B063156EVh15m6Y67pAjZZaQc89LLSrU=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"apeng.re","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.18.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="HCTF线上赛 3道RE的writeup 这是我在De1ta打得第一场比赛。结束前我做出了Lucky star和seven两道题，结束后十分钟做出了polish duck。spiral是好几天后才问了pizza做出来的。我还是太菜了，比赛又背锅，要努力学习！ 比赛时间：2018年11月9日 20:00——2018年11月11日 20:00 题目，脚本及ida数据库下载：下载地址">
<meta property="og:type" content="article">
<meta property="og:title" content="2018 HCTF 线上赛">
<meta property="og:url" content="http://apeng.re/2018/11/13/2018hctf/index.html">
<meta property="og:site_name" content="Apeng&#39;s blog">
<meta property="og:description" content="HCTF线上赛 3道RE的writeup 这是我在De1ta打得第一场比赛。结束前我做出了Lucky star和seven两道题，结束后十分钟做出了polish duck。spiral是好几天后才问了pizza做出来的。我还是太菜了，比赛又背锅，要努力学习！ 比赛时间：2018年11月9日 20:00——2018年11月11日 20:00 题目，脚本及ida数据库下载：下载地址">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2018-11-12T16:34:27.000Z">
<meta property="article:modified_time" content="2023-03-24T14:14:17.016Z">
<meta property="article:author" content="Apeng">
<meta property="article:tag" content="SMC">
<meta property="article:tag" content="反调试">
<meta property="article:tag" content="驱动">
<meta property="article:tag" content="AVR">
<meta property="article:tag" content="VM">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://apeng.re/2018/11/13/2018hctf/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://apeng.re/2018/11/13/2018hctf/","path":"/2018/11/13/2018hctf/","title":"2018 HCTF 线上赛"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>2018 HCTF 线上赛 | Apeng's blog</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="Apeng's blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Apeng's blog</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Reverse Everything</p>
      <img class="custom-logo-image" src="/uploads/custom-logo.png" alt="Apeng's blog">
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#lucky-star"><span class="nav-number">1.</span> <span class="nav-text">Lucky star</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#seven"><span class="nav-number">2.</span> <span class="nav-text">seven</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#polishduck"><span class="nav-number">3.</span> <span class="nav-text">PolishDuck</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#spiral"><span class="nav-number">4.</span> <span class="nav-text">Spiral</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#part-a"><span class="nav-number">4.1.</span> <span class="nav-text">part A</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#part-b"><span class="nav-number">4.2.</span> <span class="nav-text">part B</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Apeng</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">32</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">61</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/Apeng7364" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Apeng7364" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:apeng622@gmail.com" title="E-Mail → mailto:apeng622@gmail.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/Apeng_7364" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;Apeng_7364" rel="noopener me" target="_blank"><i class="fab fa-twitter fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="/atom.xml" title="RSS → &#x2F;atom.xml" rel="noopener me"><i class="fa fa-rss fa-fw"></i></a>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/deed.zh" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/big/by_nc_nd.svg" alt="Creative Commons"></a>
  </div>

        </div>
      </div>
    </div>

    
    <div class="sidebar-inner sidebar-blogroll">
      <div class="links-of-blogroll animated">
        <div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i>
          链接
        </div>
        <ul class="links-of-blogroll-list">
            <li class="links-of-blogroll-item">
              <a href="/friends" title="&#x2F;friends">Friends</a>
            </li>
        </ul>
      </div>
    </div>
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://apeng.re/2018/11/13/2018hctf/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Apeng">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Apeng's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="2018 HCTF 线上赛 | Apeng's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          2018 HCTF 线上赛
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-11-13 00:34:27" itemprop="dateCreated datePublished" datetime="2018-11-13T00:34:27+08:00">2018-11-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-03-24 22:14:17" itemprop="dateModified" datetime="2023-03-24T22:14:17+08:00">2023-03-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CTF-writeup/" itemprop="url" rel="index"><span itemprop="name">CTF writeup</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CTF-writeup/2018/" itemprop="url" rel="index"><span itemprop="name">2018</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p>HCTF线上赛 3道RE的writeup</p>
<p>这是我在De1ta打得第一场比赛。结束前我做出了Lucky
star和seven两道题，结束后十分钟做出了polish
duck。spiral是好几天后才问了pizza做出来的。我还是太菜了，比赛又背锅，要努力学习！</p>
<p>比赛时间：2018年11月9日 20:00——2018年11月11日 20:00</p>
<p>题目，脚本及ida数据库下载：<a target="_blank" rel="noopener" href="https://github.com/Apeng7364/ctf/tree/master/ctf2018/hjb">下载地址</a></p>
<span id="more"></span>
<h2 id="lucky-star">Lucky star</h2>
<p>找main函数，发现是smc过的，找找其他地方 0040155D和004015CA
调用了了一个反调试函数，把参数0x11改成0
00403148有一段进程名的字符串，全改成0
0040251b调用了另一个反调试函数，把下方的00402521的jz改成jmp
全部改完打个补丁，程序就能正常运行了。
在调用main函数的地方00401C20设下断点，开始调试，断下的时候main函数就解析好了
先播放了一段音频，中间还有sleep，大概一分钟，不相等可以直接把那一段的cmp
jz改成cmp jmp</p>
<p>004015E0是加密函数 加密算法如下： 先把输入进行base64加密
a2位base64加密完的 它的base64大小写是反的</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">v14=<span class="number">0</span></span><br><span class="line">v19 = <span class="built_in">strlen</span>(a2);</span><br><span class="line">  <span class="keyword">if</span> ( v19 &gt; <span class="number">0</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      v16 = <span class="number">6</span>;</span><br><span class="line">      <span class="keyword">do</span></span><br><span class="line">      &#123;</span><br><span class="line">        v17 = rand() % <span class="number">4</span>;</span><br><span class="line">        v18 = v16;</span><br><span class="line">        v16 -= <span class="number">2</span>;</span><br><span class="line">        result = (_BYTE)v17 &lt;&lt; v18;</span><br><span class="line">        a2[v14] ^= result;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">while</span> ( v16 &gt; <span class="number">-2</span> );</span><br><span class="line">      ++v14;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( v14 &lt; v19 );</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>可以看到，他对每一个字符异或了四个随机数（先对随机数进行了一些操作），在异或的地方设下条件记录断点，记录下异或的数据，然后反向解密就行了。</p>
<p>解密：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">secret=[<span class="number">0x49</span>,<span class="number">0xE6</span>,<span class="number">0x57</span>,<span class="number">0xBD</span>,<span class="number">0x3A</span>,<span class="number">0x47</span>,<span class="number">0x11</span>,<span class="number">0x4C</span>,<span class="number">0x95</span>,<span class="number">0xBC</span>,<span class="number">0xEE</span>,<span class="number">0x32</span>,<span class="number">0x72</span>,<span class="number">0xA0</span>,<span class="number">0xF0</span>,<span class="number">0xDE</span>,<span class="number">0xAC</span>,<span class="number">0xF2</span>,<span class="number">0x83</span>,<span class="number">0x56</span>,<span class="number">0x83</span>,<span class="number">0x49</span>,<span class="number">0x6E</span>,<span class="number">0xA9</span>,<span class="number">0xA6</span>,<span class="number">0xC5</span>,<span class="number">0x67</span>,<span class="number">0x3C</span>,<span class="number">0xCA</span>,<span class="number">0xC8</span>,<span class="number">0xCC</span>,<span class="number">0x05</span>]</span><br><span class="line">xor=[<span class="number">0</span>,<span class="number">0</span>,<span class="number">8</span>,<span class="number">0</span>,<span class="number">128</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">48</span>,<span class="number">8</span>,<span class="number">1</span>,<span class="number">128</span>,<span class="number">0</span>,<span class="number">12</span>,<span class="number">1</span>,<span class="number">64</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">8</span>,<span class="number">1</span>,<span class="number">64</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">2</span>,<span class="number">0</span>,<span class="number">16</span>,<span class="number">4</span>,<span class="number">0</span>,<span class="number">192</span>,<span class="number">16</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">192</span>,<span class="number">48</span>,<span class="number">0</span>,<span class="number">2</span>,<span class="number">128</span>,<span class="number">16</span>,<span class="number">8</span>,<span class="number">0</span>,<span class="number">64</span>,<span class="number">32</span>,<span class="number">4</span>,<span class="number">2</span>,<span class="number">0</span>,<span class="number">48</span>,<span class="number">0</span>,<span class="number">3</span>,<span class="number">192</span>,<span class="number">16</span>,<span class="number">4</span>,<span class="number">2</span>,<span class="number">192</span>,<span class="number">0</span>,<span class="number">8</span>,<span class="number">1</span>,<span class="number">128</span>,<span class="number">48</span>,<span class="number">0</span>,<span class="number">2</span>,<span class="number">192</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">128</span>,<span class="number">16</span>,<span class="number">4</span>,<span class="number">1</span>,<span class="number">128</span>,<span class="number">48</span>,<span class="number">4</span>,<span class="number">2</span>,<span class="number">0</span>,<span class="number">16</span>,<span class="number">12</span>,<span class="number">2</span>,<span class="number">192</span>,<span class="number">0</span>,<span class="number">4</span>,<span class="number">3</span>,<span class="number">0</span>,<span class="number">32</span>,<span class="number">12</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">16</span>,<span class="number">12</span>,<span class="number">0</span>,<span class="number">192</span>,<span class="number">32</span>,<span class="number">12</span>,<span class="number">3</span>,<span class="number">192</span>,<span class="number">16</span>,<span class="number">0</span>,<span class="number">2</span>,<span class="number">128</span>,<span class="number">48</span>,<span class="number">0</span>,<span class="number">2</span>,<span class="number">64</span>,<span class="number">16</span>,<span class="number">12</span>,<span class="number">3</span>,<span class="number">64</span>,<span class="number">32</span>,<span class="number">4</span>,<span class="number">2</span>,<span class="number">128</span>,<span class="number">0</span>,<span class="number">12</span>,<span class="number">0</span>,<span class="number">128</span>,<span class="number">48</span>,<span class="number">8</span>,<span class="number">1</span>,<span class="number">192</span>,<span class="number">48</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">48</span>,<span class="number">8</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">16</span>,<span class="number">4</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">8</span>,<span class="number">0</span>,<span class="number">128</span>,<span class="number">0</span>,<span class="number">12</span>,<span class="number">3</span>,<span class="number">192</span>,<span class="number">0</span>,<span class="number">12</span>,<span class="number">2</span>,<span class="number">192</span>,<span class="number">32</span>,<span class="number">8</span>,<span class="number">1</span>,<span class="number">64</span>,<span class="number">48</span>,<span class="number">12</span>,<span class="number">3</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">12</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">4</span>,<span class="number">1</span>]</span><br><span class="line">a=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(secret)):</span><br><span class="line">    a+=<span class="built_in">chr</span>(secret[i]^xor[<span class="number">4</span>*i]^xor[<span class="number">4</span>*i+<span class="number">1</span>]^xor[<span class="number">4</span>*i+<span class="number">2</span>]^xor[<span class="number">4</span>*i+<span class="number">3</span>])</span><br><span class="line"><span class="built_in">print</span>(a)</span><br></pre></td></tr></table></figure>
<p>解密后： Agn0zNSXENvTAv9lmg5HDdrFtw8ZFq==
它的base64加密大小写是反的，手动换一下= =
aGN0ZnsxenVtaV9LMG5hdDRfTW8zfQ==</p>
<blockquote>
<p>hctf{1zumi_K0nat4_Mo3}</p>
</blockquote>
<p>这里不知道为什么少了}，可能是base64的问题？</p>
<h2 id="seven">seven</h2>
<p>驱动逆向 sub_140001000中kbdclass应该跟键盘有关，但不知道怎么输入的
sub_1400012F0应该是解密函数了 中间有一段代码：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( *v6 == <span class="number">0x11</span> )                        <span class="comment">// up</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> ( v5 &amp; <span class="number">0xFFFFFFF0</span> )</span><br><span class="line">        &#123;</span><br><span class="line">          v5 -= <span class="number">0x10</span>;</span><br><span class="line">          <span class="keyword">goto</span> LABEL_13;</span><br><span class="line">        &#125;</span><br><span class="line">        v5 += <span class="number">0xD0</span>;</span><br><span class="line">        dword_1400030E4 = v5;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> ( v8 != <span class="number">0x1F</span> )                         <span class="comment">// down</span></span><br><span class="line">        <span class="keyword">goto</span> LABEL_14;</span><br><span class="line">      <span class="keyword">if</span> ( (v5 &amp; <span class="number">0xFFFFFFF0</span>) == <span class="number">0xD0</span> )</span><br><span class="line">        v5 -= <span class="number">0xD0</span>;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        v5 += <span class="number">0x10</span>;</span><br><span class="line">LABEL_13:</span><br><span class="line">      dword_1400030E4 = v5;</span><br><span class="line">LABEL_14:</span><br><span class="line">      <span class="keyword">if</span> ( v8 == <span class="number">0x1E</span> )                           <span class="comment">// left</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> ( v5 &amp; <span class="number">0xF</span> )</span><br><span class="line">          --v5;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">          v5 += <span class="number">0xF</span>;</span><br><span class="line">        dword_1400030E4 = v5;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> ( v8 == <span class="number">0x20</span> )                           <span class="comment">// right</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> ( (v5 &amp; <span class="number">0xF</span>) == <span class="number">15</span> )</span><br><span class="line">          v5 -= <span class="number">15</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">          ++v5;</span><br><span class="line">        dword_1400030E4 = v5;</span><br><span class="line">      &#125;</span><br><span class="line">      v9 = aO[v5];</span><br><span class="line">      <span class="keyword">if</span> ( v9 == <span class="string">&#x27;*&#x27;</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        v10 = <span class="string">&quot;-1s\n&quot;</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> ( v9 != <span class="string">&#x27;7&#x27;</span> )</span><br><span class="line">        &#123;</span><br><span class="line">LABEL_29:</span><br><span class="line">          aO[v5] = <span class="string">&#x27;o&#x27;</span>;</span><br><span class="line">          <span class="keyword">goto</span> LABEL_30;</span><br><span class="line">        &#125;</span><br><span class="line">        v10 = <span class="string">&quot;The input is the flag!\n&quot;</span>;</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>
<p>aO为字符串</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">****************</span><br><span class="line">o..............*</span><br><span class="line">**************.*</span><br><span class="line">************...*</span><br><span class="line">***********..***</span><br><span class="line">**********..****</span><br><span class="line">*********..*****</span><br><span class="line">********..******</span><br><span class="line">*******..*******</span><br><span class="line">******..********</span><br><span class="line">*****..*********</span><br><span class="line">****..**********</span><br><span class="line">****7***********</span><br></pre></td></tr></table></figure>
<hr>
<p>要把这个o走到7的位置 0x11 0x1F 0x1E 0x20是硬件扫描码
wsad，对应写出移动的顺序就行了</p>
<blockquote>
<p>flag:hctf{ddddddddddddddssaasasasasasasasasas}</p>
</blockquote>
<h2 id="polishduck">PolishDuck</h2>
<p>找到了字符串 Arduino leonardo，是单片机的型号。</p>
<p>做法是瞎猜的，没想到能做出来= =
这是个hex文件，首先不知道它机器的芯片，先用ida直接打开，能看到解析后的内容，也可以用相关工具解析成bin再用ida打开。发现0180地址出有一串字符串Arduino
LLC Arduino Leonardo 这是它机器的型号，查找资料知道是avr架构的ATmega32u
ida打开的时候，processer type 选Atmel
AVR，打开后选ATmega32_L，可以反汇编了。 在0D40地址看到</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">notepad.exe 44646 + ( 64094 + (71825 * ( ( 15873 + ( 21793 * ( 7234 + ( 17649 * ( ( 2155 + ( 74767 * ( 35392 + ( 88216 * ( 83920 + ( 16270 + ( 20151 * ( 5268 + ( 90693 * ( 82773 + ( 716 + 27377 * ( 44329 + ( 49366 * ( ( ( 38790 + ( 70247 * ( 97233 + ( 18347 + ( 22117 * ( ( ( 72576 + ( ( 47541 + ( 46975 + ( 53769 * ( 94005 + ( ( 72914 + ( 5137 + ( 87544 * 71583 + ( 20370 + ( 37968 * ( 17478 + ( ( 40532 + ( 10089 + ( 13332 * ( ( 24170 + ( 46845 * ( 16048 + 23142 * ( 31895 + ( 62386 * ( 12179 ( 94552 + ( ( ( 52918 + ( 91580 + ( ( ( 38412 + ( 91537 * ( 70 + ( 98594 * ( ( 35275 + ( 62912 * ( 4755 + ( 16737 * ( 27595 + ( ( 43551 + ( 64482 * 3550 ) ) - 21031 ) ) ) ) ) ) - 57553 ) ) - 89883 ) - 38900 ) ) ) - 19517 ) - 79082 ) ) ) ) ) ) ) ) - 70643 ) ) 55350 ) ) ) ) ) - 40301 ) ) ) ) - 83065 ) ) ) ) ) - 52460 ) ) - 49428 ) - 94686 ) ) ) ) ) ) - 1653 ) - 65217 ) ) ) - 43827 ) 66562 ) )</span><br></pre></td></tr></table></figure>
<p>不是一个完整的式子，不能计算，想起他方向。 这不是一个
完整的字符串，而是很多个字符串（中间有），大致猜一下可能是选取其中某些字符串拼接起来，就能计算了
从开头开始跟踪，跟踪到sub_9A8，应该是解析相关的函数了。
往下找，找到可疑的地方0A6C开始：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">ROM:0A6C                 ldi     r22, 0xF4</span><br><span class="line">ROM:0A6D                 ldi     r23, 1</span><br><span class="line">ROM:0A6E                 ldi     r24, 0</span><br><span class="line">ROM:0A6F                 ldi     r25, 0</span><br><span class="line">ROM:0A70                 call    sub_8B6</span><br><span class="line">ROM:0A72                 ldi     r24, 0x40 ; &#x27;@&#x27;</span><br><span class="line">ROM:0A73                 ldi     r25, 1</span><br><span class="line">ROM:0A74                 call    sub_88D</span><br><span class="line">ROM:0A76                 ldi     r22, 0xF4</span><br><span class="line">ROM:0A77                 ldi     r23, 1</span><br><span class="line">ROM:0A78                 ldi     r24, 0</span><br><span class="line">ROM:0A79                 ldi     r25, 0</span><br><span class="line">ROM:0A7A                 call    sub_8B6</span><br><span class="line">ROM:0A7C                 ldi     r24, 0x4C ; &#x27;L&#x27;</span><br><span class="line">ROM:0A7D                 ldi     r25, 1</span><br><span class="line">ROM:0A7E                 call    sub_88D</span><br><span class="line">ROM:0A80                 ldi     r22, 0xF4</span><br><span class="line">ROM:0A81                 ldi     r23, 1</span><br><span class="line">ROM:0A82                 ldi     r24, 0</span><br><span class="line">ROM:0A83                 ldi     r25, 0</span><br><span class="line">ROM:0A84                 call    sub_8B6</span><br><span class="line">ROM:0A86                 ldi     r24, 0x53 ; &#x27;S&#x27;</span><br><span class="line">ROM:0A87                 ldi     r25, 1</span><br><span class="line">ROM:0A88                 call    sub_88D</span><br><span class="line">ROM:0A8A                 ldi     r22, 0xF4</span><br><span class="line">ROM:0A8B                 ldi     r23, 1</span><br><span class="line">ROM:0A8C                 ldi     r24, 0</span><br><span class="line">ROM:0A8D                 ldi     r25, 0</span><br><span class="line">ROM:0A8E                 call    sub_8B6</span><br><span class="line">ROM:0A90                 ldi     r24, 0x62 ; &#x27;b&#x27;</span><br><span class="line">ROM:0A91                 ldi     r25, 1</span><br><span class="line">ROM:0A92                 call    sub_88D</span><br></pre></td></tr></table></figure>
<p>有很多结构十分相似的部分，把不一样的地方都提取出来，是一堆地址</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">140  14C  153  162  177  18B  1A9  1C8  1D3  1EB  1FE  25E  207 21C 227 246 261 270 28B 298 2A3 2B1 25C 2BA 2C5 2D0 2D7 2F2 307 310 25E 327 346 3DC 34D 364 373 38F 3A6 3B3 3BF 3D0 3DF 3EF 400 44B 413 42C 43B 44F 452 490 45F 46C 47D 48E 497 49E 4B5 4CB 445 445 4D6 44D 44D 494 4E5 44F</span><br></pre></td></tr></table></figure>
<p>这些地址并不指向任何东西，但如过把140对应之前字符串的开头notepad.exe，14C刚好能对应第二个字符串开头44646，以此类推，而某些地址可能指向的不是某一字符串的开头，这样猜测整合完应该能得到完整算术式
试着把他们一一对应过去</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> <span class="type">char</span> secret[] = &#123; <span class="number">0x6E</span>, <span class="number">0x6F</span>, <span class="number">0x74</span>, <span class="number">0x65</span>, <span class="number">0x70</span>, <span class="number">0x61</span>, <span class="number">0x64</span>, <span class="number">0x2E</span>, <span class="number">0x65</span>, <span class="number">0x78</span>,<span class="number">0x65</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x34</span>, <span class="number">0x36</span>, <span class="number">0x34</span>, <span class="number">0x36</span>, <span class="number">0x20</span>, <span class="number">0x00</span>, <span class="number">0x2B</span>,<span class="number">0x20</span>, <span class="number">0x28</span>, <span class="number">0x20</span>, <span class="number">0x36</span>, <span class="number">0x34</span>, <span class="number">0x30</span>, <span class="number">0x39</span>, <span class="number">0x34</span>, <span class="number">0x20</span>, <span class="number">0x2B</span>,<span class="number">0x20</span>, <span class="number">0x28</span>, <span class="number">0x20</span>, <span class="number">0x00</span>, <span class="number">0x37</span>, <span class="number">0x31</span>, <span class="number">0x38</span>, <span class="number">0x32</span>, <span class="number">0x35</span>, <span class="number">0x20</span>,<span class="number">0x2A</span>, <span class="number">0x20</span>, <span class="number">0x28</span>, <span class="number">0x20</span>, <span class="number">0x28</span>, <span class="number">0x20</span>, <span class="number">0x31</span>, <span class="number">0x35</span>, <span class="number">0x38</span>, <span class="number">0x37</span>,<span class="number">0x33</span>, <span class="number">0x20</span>, <span class="number">0x2B</span>, <span class="number">0x20</span>, <span class="number">0x00</span>, <span class="number">0x28</span>, <span class="number">0x20</span>, <span class="number">0x32</span>, <span class="number">0x31</span>, <span class="number">0x37</span>,<span class="number">0x39</span>, <span class="number">0x33</span>, <span class="number">0x20</span>, <span class="number">0x2A</span>, <span class="number">0x20</span>, <span class="number">0x28</span>, <span class="number">0x20</span>, <span class="number">0x37</span>, <span class="number">0x32</span>, <span class="number">0x33</span>,<span class="number">0x34</span>, <span class="number">0x20</span>, <span class="number">0x2B</span>, <span class="number">0x20</span>, <span class="number">0x00</span>, <span class="number">0x28</span>, <span class="number">0x20</span>, <span class="number">0x31</span>, <span class="number">0x37</span>, <span class="number">0x36</span>,<span class="number">0x34</span>, <span class="number">0x39</span>, <span class="number">0x20</span>, <span class="number">0x2A</span>, <span class="number">0x20</span>, <span class="number">0x28</span>, <span class="number">0x20</span>, <span class="number">0x28</span>, <span class="number">0x20</span>, <span class="number">0x32</span>,<span class="number">0x31</span>, <span class="number">0x35</span>, <span class="number">0x35</span>, <span class="number">0x20</span>, <span class="number">0x2B</span>, <span class="number">0x20</span>, <span class="number">0x28</span>, <span class="number">0x20</span>, <span class="number">0x37</span>, <span class="number">0x34</span>,<span class="number">0x37</span>, <span class="number">0x36</span>, <span class="number">0x37</span>, <span class="number">0x20</span>, <span class="number">0x00</span>, <span class="number">0x2A</span>, <span class="number">0x20</span>, <span class="number">0x28</span>, <span class="number">0x20</span>, <span class="number">0x33</span>,<span class="number">0x35</span>, <span class="number">0x33</span>, <span class="number">0x39</span>, <span class="number">0x32</span>, <span class="number">0x20</span>, <span class="number">0x2B</span>, <span class="number">0x20</span>, <span class="number">0x28</span>, <span class="number">0x20</span>, <span class="number">0x38</span>,<span class="number">0x38</span>, <span class="number">0x32</span>, <span class="number">0x31</span>, <span class="number">0x36</span>, <span class="number">0x20</span>, <span class="number">0x2A</span>, <span class="number">0x20</span>, <span class="number">0x28</span>, <span class="number">0x20</span>, <span class="number">0x38</span>,<span class="number">0x33</span>, <span class="number">0x39</span>, <span class="number">0x32</span>, <span class="number">0x30</span>, <span class="number">0x20</span>, <span class="number">0x00</span>, <span class="number">0x2B</span>, <span class="number">0x20</span>, <span class="number">0x28</span>, <span class="number">0x20</span>,<span class="number">0x31</span>, <span class="number">0x36</span>, <span class="number">0x32</span>, <span class="number">0x37</span>, <span class="number">0x30</span>, <span class="number">0x20</span>, <span class="number">0x00</span>, <span class="number">0x2B</span>, <span class="number">0x20</span>, <span class="number">0x28</span>,<span class="number">0x20</span>, <span class="number">0x32</span>, <span class="number">0x30</span>, <span class="number">0x31</span>, <span class="number">0x35</span>, <span class="number">0x31</span>, <span class="number">0x20</span>, <span class="number">0x2A</span>, <span class="number">0x20</span>, <span class="number">0x28</span>,<span class="number">0x20</span>, <span class="number">0x35</span>, <span class="number">0x32</span>, <span class="number">0x36</span>, <span class="number">0x38</span>, <span class="number">0x20</span>, <span class="number">0x2B</span>, <span class="number">0x20</span>, <span class="number">0x28</span>, <span class="number">0x20</span>,<span class="number">0x00</span>, <span class="number">0x39</span>, <span class="number">0x30</span>, <span class="number">0x36</span>, <span class="number">0x39</span>, <span class="number">0x33</span>, <span class="number">0x20</span>, <span class="number">0x2A</span>, <span class="number">0x20</span>, <span class="number">0x28</span>,<span class="number">0x20</span>, <span class="number">0x38</span>, <span class="number">0x32</span>, <span class="number">0x37</span>, <span class="number">0x37</span>, <span class="number">0x33</span>, <span class="number">0x20</span>, <span class="number">0x2B</span>, <span class="number">0x20</span>, <span class="number">0x00</span>,<span class="number">0x28</span>, <span class="number">0x20</span>, <span class="number">0x37</span>, <span class="number">0x31</span>, <span class="number">0x36</span>, <span class="number">0x20</span>, <span class="number">0x2B</span>, <span class="number">0x20</span>, <span class="number">0x00</span>, <span class="number">0x32</span>,<span class="number">0x37</span>, <span class="number">0x33</span>, <span class="number">0x37</span>, <span class="number">0x37</span>, <span class="number">0x20</span>, <span class="number">0x2A</span>, <span class="number">0x20</span>, <span class="number">0x28</span>, <span class="number">0x20</span>, <span class="number">0x34</span>,<span class="number">0x34</span>, <span class="number">0x33</span>, <span class="number">0x32</span>, <span class="number">0x39</span>, <span class="number">0x20</span>, <span class="number">0x2B</span>, <span class="number">0x20</span>, <span class="number">0x28</span>, <span class="number">0x20</span>, <span class="number">0x00</span>,<span class="number">0x34</span>, <span class="number">0x39</span>, <span class="number">0x33</span>, <span class="number">0x36</span>, <span class="number">0x36</span>, <span class="number">0x20</span>, <span class="number">0x2A</span>, <span class="number">0x20</span>, <span class="number">0x28</span>, <span class="number">0x20</span>,<span class="number">0x00</span>, <span class="number">0x28</span>, <span class="number">0x20</span>, <span class="number">0x28</span>, <span class="number">0x20</span>, <span class="number">0x33</span>, <span class="number">0x38</span>, <span class="number">0x37</span>, <span class="number">0x39</span>, <span class="number">0x30</span>,<span class="number">0x20</span>, <span class="number">0x2B</span>, <span class="number">0x20</span>, <span class="number">0x28</span>, <span class="number">0x20</span>, <span class="number">0x37</span>, <span class="number">0x30</span>, <span class="number">0x32</span>, <span class="number">0x34</span>, <span class="number">0x37</span>,<span class="number">0x20</span>, <span class="number">0x2A</span>, <span class="number">0x20</span>, <span class="number">0x28</span>, <span class="number">0x20</span>, <span class="number">0x39</span>, <span class="number">0x37</span>, <span class="number">0x32</span>, <span class="number">0x33</span>, <span class="number">0x33</span>,<span class="number">0x20</span>, <span class="number">0x00</span>, <span class="number">0x2B</span>, <span class="number">0x20</span>, <span class="number">0x28</span>, <span class="number">0x20</span>, <span class="number">0x31</span>, <span class="number">0x38</span>, <span class="number">0x33</span>, <span class="number">0x34</span>,<span class="number">0x37</span>, <span class="number">0x20</span>, <span class="number">0x2B</span>, <span class="number">0x20</span>, <span class="number">0x28</span>, <span class="number">0x20</span>, <span class="number">0x32</span>, <span class="number">0x32</span>, <span class="number">0x31</span>, <span class="number">0x31</span>,<span class="number">0x37</span>, <span class="number">0x20</span>, <span class="number">0x2A</span>, <span class="number">0x20</span>, <span class="number">0x28</span>, <span class="number">0x20</span>, <span class="number">0x28</span>, <span class="number">0x20</span>, <span class="number">0x00</span>, <span class="number">0x28</span>,<span class="number">0x20</span>, <span class="number">0x37</span>, <span class="number">0x32</span>, <span class="number">0x35</span>, <span class="number">0x37</span>, <span class="number">0x36</span>, <span class="number">0x20</span>, <span class="number">0x2B</span>, <span class="number">0x20</span>, <span class="number">0x28</span>,<span class="number">0x20</span>, <span class="number">0x28</span>, <span class="number">0x20</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x37</span>, <span class="number">0x35</span>, <span class="number">0x34</span>, <span class="number">0x31</span>, <span class="number">0x20</span>,<span class="number">0x2B</span>, <span class="number">0x20</span>, <span class="number">0x28</span>, <span class="number">0x20</span>, <span class="number">0x34</span>, <span class="number">0x36</span>, <span class="number">0x39</span>, <span class="number">0x37</span>, <span class="number">0x35</span>, <span class="number">0x20</span>,<span class="number">0x2B</span>, <span class="number">0x20</span>, <span class="number">0x28</span>, <span class="number">0x20</span>, <span class="number">0x35</span>, <span class="number">0x33</span>, <span class="number">0x37</span>, <span class="number">0x36</span>, <span class="number">0x39</span>, <span class="number">0x20</span>,<span class="number">0x00</span>, <span class="number">0x2A</span>, <span class="number">0x20</span>, <span class="number">0x28</span>, <span class="number">0x20</span>, <span class="number">0x39</span>, <span class="number">0x34</span>, <span class="number">0x30</span>, <span class="number">0x30</span>, <span class="number">0x35</span>,<span class="number">0x20</span>, <span class="number">0x2B</span>, <span class="number">0x20</span>, <span class="number">0x00</span>, <span class="number">0x28</span>, <span class="number">0x20</span>, <span class="number">0x28</span>, <span class="number">0x20</span>, <span class="number">0x37</span>, <span class="number">0x32</span>,<span class="number">0x39</span>, <span class="number">0x31</span>, <span class="number">0x34</span>, <span class="number">0x20</span>, <span class="number">0x00</span>, <span class="number">0x2B</span>, <span class="number">0x20</span>, <span class="number">0x28</span>, <span class="number">0x20</span>, <span class="number">0x35</span>,<span class="number">0x31</span>, <span class="number">0x33</span>, <span class="number">0x37</span>, <span class="number">0x20</span>, <span class="number">0x2B</span>, <span class="number">0x20</span>, <span class="number">0x28</span>, <span class="number">0x20</span>, <span class="number">0x00</span>, <span class="number">0x38</span>,<span class="number">0x37</span>, <span class="number">0x35</span>, <span class="number">0x34</span>, <span class="number">0x34</span>, <span class="number">0x20</span>, <span class="number">0x2A</span>, <span class="number">0x20</span>, <span class="number">0x00</span>, <span class="number">0x37</span>, <span class="number">0x31</span>,<span class="number">0x35</span>, <span class="number">0x38</span>, <span class="number">0x33</span>, <span class="number">0x20</span>, <span class="number">0x2B</span>, <span class="number">0x20</span>, <span class="number">0x28</span>, <span class="number">0x20</span>, <span class="number">0x00</span>, <span class="number">0x32</span>,<span class="number">0x30</span>, <span class="number">0x33</span>, <span class="number">0x37</span>, <span class="number">0x30</span>, <span class="number">0x20</span>, <span class="number">0x2B</span>, <span class="number">0x20</span>, <span class="number">0x28</span>, <span class="number">0x20</span>, <span class="number">0x00</span>,<span class="number">0x33</span>, <span class="number">0x37</span>, <span class="number">0x39</span>, <span class="number">0x36</span>, <span class="number">0x38</span>, <span class="number">0x20</span>, <span class="number">0x00</span>, <span class="number">0x2A</span>, <span class="number">0x20</span>, <span class="number">0x28</span>,<span class="number">0x20</span>, <span class="number">0x31</span>, <span class="number">0x37</span>, <span class="number">0x34</span>, <span class="number">0x37</span>, <span class="number">0x38</span>, <span class="number">0x20</span>, <span class="number">0x2B</span>, <span class="number">0x20</span>, <span class="number">0x28</span>,<span class="number">0x20</span>, <span class="number">0x28</span>, <span class="number">0x20</span>, <span class="number">0x34</span>, <span class="number">0x30</span>, <span class="number">0x35</span>, <span class="number">0x33</span>, <span class="number">0x32</span>, <span class="number">0x20</span>, <span class="number">0x2B</span>,<span class="number">0x20</span>, <span class="number">0x28</span>, <span class="number">0x20</span>, <span class="number">0x00</span>, <span class="number">0x31</span>, <span class="number">0x30</span>, <span class="number">0x30</span>, <span class="number">0x38</span>, <span class="number">0x39</span>, <span class="number">0x20</span>,<span class="number">0x2B</span>, <span class="number">0x20</span>, <span class="number">0x28</span>, <span class="number">0x20</span>, <span class="number">0x31</span>, <span class="number">0x33</span>, <span class="number">0x33</span>, <span class="number">0x33</span>, <span class="number">0x32</span>, <span class="number">0x20</span>,<span class="number">0x2A</span>, <span class="number">0x20</span>, <span class="number">0x28</span>, <span class="number">0x20</span>, <span class="number">0x00</span>, <span class="number">0x28</span>, <span class="number">0x20</span>, <span class="number">0x32</span>, <span class="number">0x34</span>, <span class="number">0x31</span>,<span class="number">0x37</span>, <span class="number">0x30</span>, <span class="number">0x20</span>, <span class="number">0x00</span>, <span class="number">0x2B</span>, <span class="number">0x20</span>, <span class="number">0x28</span>, <span class="number">0x20</span>, <span class="number">0x34</span>, <span class="number">0x36</span>,<span class="number">0x38</span>, <span class="number">0x34</span>, <span class="number">0x35</span>, <span class="number">0x20</span>, <span class="number">0x2A</span>, <span class="number">0x20</span>, <span class="number">0x28</span>, <span class="number">0x20</span>, <span class="number">0x31</span>, <span class="number">0x36</span>,<span class="number">0x30</span>, <span class="number">0x34</span>, <span class="number">0x38</span>, <span class="number">0x20</span>, <span class="number">0x2B</span>, <span class="number">0x20</span>, <span class="number">0x00</span>, <span class="number">0x32</span>, <span class="number">0x33</span>, <span class="number">0x31</span>,<span class="number">0x34</span>, <span class="number">0x32</span>, <span class="number">0x20</span>, <span class="number">0x2A</span>, <span class="number">0x20</span>, <span class="number">0x28</span>, <span class="number">0x20</span>, <span class="number">0x33</span>, <span class="number">0x31</span>, <span class="number">0x38</span>,<span class="number">0x39</span>, <span class="number">0x35</span>, <span class="number">0x20</span>, <span class="number">0x2B</span>, <span class="number">0x20</span>, <span class="number">0x28</span>, <span class="number">0x20</span>, <span class="number">0x36</span>, <span class="number">0x32</span>, <span class="number">0x33</span>,<span class="number">0x38</span>, <span class="number">0x36</span>, <span class="number">0x20</span>, <span class="number">0x2A</span>, <span class="number">0x20</span>, <span class="number">0x28</span>, <span class="number">0x20</span>, <span class="number">0x00</span>, <span class="number">0x31</span>, <span class="number">0x32</span>,<span class="number">0x31</span>, <span class="number">0x37</span>, <span class="number">0x39</span>, <span class="number">0x20</span>, <span class="number">0x00</span>, <span class="number">0x28</span>, <span class="number">0x20</span>, <span class="number">0x39</span>, <span class="number">0x34</span>, <span class="number">0x35</span>,<span class="number">0x35</span>, <span class="number">0x32</span>, <span class="number">0x20</span>, <span class="number">0x2B</span>, <span class="number">0x20</span>, <span class="number">0x28</span>, <span class="number">0x20</span>, <span class="number">0x28</span>, <span class="number">0x20</span>, <span class="number">0x28</span>,<span class="number">0x20</span>, <span class="number">0x35</span>, <span class="number">0x32</span>, <span class="number">0x39</span>, <span class="number">0x31</span>, <span class="number">0x38</span>, <span class="number">0x20</span>, <span class="number">0x00</span>, <span class="number">0x2B</span>, <span class="number">0x20</span>,<span class="number">0x28</span>, <span class="number">0x20</span>, <span class="number">0x39</span>, <span class="number">0x31</span>, <span class="number">0x35</span>, <span class="number">0x38</span>, <span class="number">0x30</span>, <span class="number">0x20</span>, <span class="number">0x2B</span>, <span class="number">0x20</span>,<span class="number">0x28</span>, <span class="number">0x20</span>, <span class="number">0x00</span>, <span class="number">0x28</span>, <span class="number">0x20</span>, <span class="number">0x28</span>, <span class="number">0x20</span>, <span class="number">0x33</span>, <span class="number">0x38</span>, <span class="number">0x34</span>,<span class="number">0x31</span>, <span class="number">0x32</span>, <span class="number">0x20</span>, <span class="number">0x2B</span>, <span class="number">0x20</span>, <span class="number">0x28</span>, <span class="number">0x20</span>, <span class="number">0x39</span>, <span class="number">0x31</span>, <span class="number">0x35</span>,<span class="number">0x33</span>, <span class="number">0x37</span>, <span class="number">0x20</span>, <span class="number">0x2A</span>, <span class="number">0x20</span>, <span class="number">0x28</span>, <span class="number">0x20</span>, <span class="number">0x37</span>, <span class="number">0x30</span>, <span class="number">0x20</span>,<span class="number">0x00</span>, <span class="number">0x2B</span>, <span class="number">0x20</span>, <span class="number">0x28</span>, <span class="number">0x20</span>, <span class="number">0x39</span>, <span class="number">0x38</span>, <span class="number">0x35</span>, <span class="number">0x39</span>, <span class="number">0x34</span>,<span class="number">0x20</span>, <span class="number">0x2A</span>, <span class="number">0x20</span>, <span class="number">0x28</span>, <span class="number">0x20</span>, <span class="number">0x28</span>, <span class="number">0x20</span>, <span class="number">0x33</span>, <span class="number">0x35</span>, <span class="number">0x32</span>,<span class="number">0x37</span>, <span class="number">0x35</span>, <span class="number">0x20</span>, <span class="number">0x00</span>, <span class="number">0x2B</span>, <span class="number">0x20</span>, <span class="number">0x28</span>, <span class="number">0x20</span>, <span class="number">0x36</span>, <span class="number">0x32</span>,<span class="number">0x39</span>, <span class="number">0x31</span>, <span class="number">0x32</span>, <span class="number">0x20</span>, <span class="number">0x2A</span>, <span class="number">0x20</span>, <span class="number">0x00</span>, <span class="number">0x28</span>, <span class="number">0x20</span>, <span class="number">0x34</span>,<span class="number">0x37</span>, <span class="number">0x35</span>, <span class="number">0x35</span>, <span class="number">0x20</span>, <span class="number">0x2B</span>, <span class="number">0x20</span>, <span class="number">0x28</span>, <span class="number">0x20</span>, <span class="number">0x00</span>, <span class="number">0x31</span>,<span class="number">0x36</span>, <span class="number">0x37</span>, <span class="number">0x33</span>, <span class="number">0x37</span>, <span class="number">0x20</span>, <span class="number">0x2A</span>, <span class="number">0x20</span>, <span class="number">0x28</span>, <span class="number">0x20</span>, <span class="number">0x32</span>,<span class="number">0x37</span>, <span class="number">0x35</span>, <span class="number">0x39</span>, <span class="number">0x35</span>, <span class="number">0x20</span>, <span class="number">0x00</span>, <span class="number">0x2B</span>, <span class="number">0x20</span>, <span class="number">0x28</span>, <span class="number">0x20</span>,<span class="number">0x28</span>, <span class="number">0x20</span>, <span class="number">0x34</span>, <span class="number">0x33</span>, <span class="number">0x35</span>, <span class="number">0x35</span>, <span class="number">0x31</span>, <span class="number">0x20</span>, <span class="number">0x2B</span>, <span class="number">0x20</span>,<span class="number">0x00</span>, <span class="number">0x28</span>, <span class="number">0x20</span>, <span class="number">0x36</span>, <span class="number">0x34</span>, <span class="number">0x34</span>, <span class="number">0x38</span>, <span class="number">0x32</span>, <span class="number">0x20</span>, <span class="number">0x2A</span>,<span class="number">0x20</span>, <span class="number">0x33</span>, <span class="number">0x35</span>, <span class="number">0x35</span>, <span class="number">0x30</span>, <span class="number">0x20</span>, <span class="number">0x00</span>, <span class="number">0x29</span>, <span class="number">0x20</span>, <span class="number">0x29</span>,<span class="number">0x20</span>, <span class="number">0x2D</span>, <span class="number">0x20</span>, <span class="number">0x32</span>, <span class="number">0x31</span>, <span class="number">0x30</span>, <span class="number">0x33</span>, <span class="number">0x31</span>, <span class="number">0x20</span>, <span class="number">0x29</span>,<span class="number">0x20</span>, <span class="number">0x29</span>, <span class="number">0x20</span>, <span class="number">0x00</span>, <span class="number">0x29</span>, <span class="number">0x20</span>, <span class="number">0x29</span>, <span class="number">0x20</span>, <span class="number">0x29</span>, <span class="number">0x20</span>,<span class="number">0x29</span>, <span class="number">0x20</span>, <span class="number">0x2D</span>, <span class="number">0x20</span>, <span class="number">0x35</span>, <span class="number">0x37</span>, <span class="number">0x35</span>, <span class="number">0x35</span>, <span class="number">0x33</span>, <span class="number">0x20</span>,<span class="number">0x29</span>, <span class="number">0x20</span>, <span class="number">0x00</span>, <span class="number">0x29</span>, <span class="number">0x20</span>, <span class="number">0x2D</span>, <span class="number">0x20</span>, <span class="number">0x38</span>, <span class="number">0x39</span>, <span class="number">0x38</span>,<span class="number">0x38</span>, <span class="number">0x33</span>, <span class="number">0x20</span>, <span class="number">0x29</span>, <span class="number">0x20</span>, <span class="number">0x2D</span>, <span class="number">0x20</span>, <span class="number">0x33</span>, <span class="number">0x38</span>, <span class="number">0x39</span>,<span class="number">0x30</span>, <span class="number">0x30</span>, <span class="number">0x20</span>, <span class="number">0x29</span>, <span class="number">0x20</span>, <span class="number">0x29</span>, <span class="number">0x20</span>, <span class="number">0x00</span>, <span class="number">0x29</span>, <span class="number">0x20</span>,<span class="number">0x2D</span>, <span class="number">0x20</span>, <span class="number">0x31</span>, <span class="number">0x39</span>, <span class="number">0x35</span>, <span class="number">0x31</span>, <span class="number">0x37</span>, <span class="number">0x20</span>, <span class="number">0x29</span>, <span class="number">0x20</span>,<span class="number">0x2D</span>, <span class="number">0x20</span>, <span class="number">0x00</span>, <span class="number">0x37</span>, <span class="number">0x39</span>, <span class="number">0x30</span>, <span class="number">0x38</span>, <span class="number">0x32</span>, <span class="number">0x20</span>, <span class="number">0x29</span>,<span class="number">0x20</span>, <span class="number">0x29</span>, <span class="number">0x20</span>, <span class="number">0x29</span>, <span class="number">0x20</span>, <span class="number">0x29</span>, <span class="number">0x20</span>, <span class="number">0x29</span>, <span class="number">0x20</span>, <span class="number">0x29</span>,<span class="number">0x20</span>, <span class="number">0x29</span>, <span class="number">0x20</span>, <span class="number">0x29</span>, <span class="number">0x20</span>, <span class="number">0x00</span>, <span class="number">0x2D</span>, <span class="number">0x20</span>, <span class="number">0x37</span>, <span class="number">0x30</span>,<span class="number">0x36</span>, <span class="number">0x34</span>, <span class="number">0x33</span>, <span class="number">0x20</span>, <span class="number">0x29</span>, <span class="number">0x20</span>, <span class="number">0x29</span>, <span class="number">0x20</span>, <span class="number">0x00</span>, <span class="number">0x35</span>,<span class="number">0x35</span>, <span class="number">0x33</span>, <span class="number">0x35</span>, <span class="number">0x30</span>, <span class="number">0x20</span>, <span class="number">0x29</span>, <span class="number">0x20</span>, <span class="number">0x29</span>, <span class="number">0x20</span>, <span class="number">0x29</span>,<span class="number">0x20</span>, <span class="number">0x00</span>, <span class="number">0x29</span>, <span class="number">0x20</span>, <span class="number">0x29</span>, <span class="number">0x20</span>, <span class="number">0x2D</span>, <span class="number">0x20</span>, <span class="number">0x34</span>, <span class="number">0x30</span>,<span class="number">0x33</span>, <span class="number">0x30</span>, <span class="number">0x31</span>, <span class="number">0x20</span>, <span class="number">0x29</span>, <span class="number">0x20</span>, <span class="number">0x29</span>, <span class="number">0x20</span>, <span class="number">0x00</span>, <span class="number">0x29</span>,<span class="number">0x20</span>, <span class="number">0x29</span>, <span class="number">0x20</span>, <span class="number">0x2D</span>, <span class="number">0x20</span>, <span class="number">0x38</span>, <span class="number">0x33</span>, <span class="number">0x30</span>, <span class="number">0x36</span>, <span class="number">0x35</span>,<span class="number">0x20</span>, <span class="number">0x29</span>, <span class="number">0x20</span>, <span class="number">0x29</span>, <span class="number">0x20</span>, <span class="number">0x00</span>, <span class="number">0x29</span>, <span class="number">0x20</span>, <span class="number">0x29</span>, <span class="number">0x20</span>,<span class="number">0x29</span>, <span class="number">0x20</span>, <span class="number">0x2D</span>, <span class="number">0x20</span>, <span class="number">0x00</span>, <span class="number">0x35</span>, <span class="number">0x32</span>, <span class="number">0x34</span>, <span class="number">0x36</span>, <span class="number">0x30</span>,<span class="number">0x20</span>, <span class="number">0x00</span>, <span class="number">0x29</span>, <span class="number">0x20</span>, <span class="number">0x29</span>, <span class="number">0x20</span>, <span class="number">0x2D</span>, <span class="number">0x20</span>, <span class="number">0x34</span>, <span class="number">0x39</span>,<span class="number">0x34</span>, <span class="number">0x32</span>, <span class="number">0x38</span>, <span class="number">0x20</span>, <span class="number">0x29</span>, <span class="number">0x20</span>, <span class="number">0x2D</span>, <span class="number">0x20</span>, <span class="number">0x39</span>, <span class="number">0x34</span>,<span class="number">0x36</span>, <span class="number">0x38</span>, <span class="number">0x36</span>, <span class="number">0x20</span>, <span class="number">0x00</span>, <span class="number">0x29</span>, <span class="number">0x20</span>, <span class="number">0x29</span>, <span class="number">0x20</span>, <span class="number">0x29</span>,<span class="number">0x20</span>, <span class="number">0x29</span>, <span class="number">0x20</span>, <span class="number">0x29</span>, <span class="number">0x20</span>, <span class="number">0x29</span>, <span class="number">0x20</span>, <span class="number">0x2D</span>, <span class="number">0x20</span>, <span class="number">0x31</span>,<span class="number">0x36</span>, <span class="number">0x35</span>, <span class="number">0x33</span>, <span class="number">0x20</span>, <span class="number">0x29</span>, <span class="number">0x20</span>, <span class="number">0x00</span>, <span class="number">0x2D</span>, <span class="number">0x20</span>, <span class="number">0x36</span>,<span class="number">0x35</span>, <span class="number">0x32</span>, <span class="number">0x31</span>, <span class="number">0x37</span>, <span class="number">0x20</span>, <span class="number">0x29</span>, <span class="number">0x20</span>, <span class="number">0x00</span>, <span class="number">0x29</span>, <span class="number">0x20</span>,<span class="number">0x29</span>, <span class="number">0x20</span>, <span class="number">0x2D</span>, <span class="number">0x20</span>, <span class="number">0x34</span>, <span class="number">0x33</span>, <span class="number">0x38</span>, <span class="number">0x32</span>, <span class="number">0x37</span>, <span class="number">0x20</span>,<span class="number">0x29</span>, <span class="number">0x20</span>, <span class="number">0x00</span>, <span class="number">0x36</span>, <span class="number">0x36</span>, <span class="number">0x35</span>, <span class="number">0x36</span>, <span class="number">0x32</span>, <span class="number">0x20</span>, <span class="number">0x29</span>,<span class="number">0x20</span>, <span class="number">0x29</span>, <span class="number">0x20</span>, <span class="number">0x00</span> &#125;;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> *p;</span><br><span class="line">    <span class="type">int</span> address[] = &#123; <span class="number">0x140</span> ,<span class="number">0x14C</span> ,<span class="number">0x153</span> ,<span class="number">0x162</span> ,<span class="number">0x177</span> ,<span class="number">0x18B</span> ,<span class="number">0x1A9</span> ,<span class="number">0x1C8</span> ,<span class="number">0x1D3</span> ,<span class="number">0x1EB</span> ,<span class="number">0x1FE</span> ,<span class="number">0x25E</span> ,<span class="number">0x207</span>,<span class="number">0x21C</span>,<span class="number">0x227</span>,<span class="number">0x246</span>,<span class="number">0x261</span>,<span class="number">0x270</span>,<span class="number">0x28B</span>,<span class="number">0x298</span>,<span class="number">0x2A3</span>,<span class="number">0x2B1</span>,<span class="number">0x25C</span>,<span class="number">0x2BA</span>,<span class="number">0x2C5</span>,<span class="number">0x2D0</span>,<span class="number">0x2D7</span>,<span class="number">0x2F2</span>,<span class="number">0x307</span>,<span class="number">0x310</span>,<span class="number">0x25E</span>,<span class="number">0x327</span>,<span class="number">0x346</span>,<span class="number">0x3DC</span>,<span class="number">0x34D</span>,<span class="number">0x364</span>,<span class="number">0x373</span>,<span class="number">0x38F</span>,<span class="number">0x3A6</span>,<span class="number">0x3B3</span>,<span class="number">0x3BF</span>,<span class="number">0x3D0</span>,<span class="number">0x3DF</span>,<span class="number">0x3EF</span>,<span class="number">0x400</span>,<span class="number">0x44B</span>,<span class="number">0x413</span>,<span class="number">0x42C</span>,<span class="number">0x43B</span>,<span class="number">0x44F</span>,<span class="number">0x452</span>,<span class="number">0x490</span>,<span class="number">0x45F</span>,<span class="number">0x46C</span>,<span class="number">0x47D</span>,<span class="number">0x48E</span>,<span class="number">0x497</span>,<span class="number">0x49E</span>,<span class="number">0x4B5</span>,<span class="number">0x4CB</span>,<span class="number">0x445</span>,<span class="number">0x445</span>,<span class="number">0x4D6</span>,<span class="number">0x44D</span>,<span class="number">0x44D</span>,<span class="number">0x494</span>,<span class="number">0x4E5</span>,<span class="number">0x44F</span> &#125;;</span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">68</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        p = &amp;secret[<span class="number">0</span>] + address[i]<span class="number">-0x140</span>;</span><br><span class="line">        cout &lt;&lt; p;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>得到完整的算术表达式，用python算出flag</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a=<span class="number">44646</span> + ( <span class="number">64094</span> + ( <span class="number">71825</span> * ( ( <span class="number">15873</span> + ( <span class="number">21793</span> * ( <span class="number">7234</span> + ( <span class="number">17649</span> * ( ( <span class="number">2155</span> + ( <span class="number">74767</span> * ( <span class="number">35392</span> + ( <span class="number">88216</span> * ( <span class="number">83920</span> + ( <span class="number">16270</span> + ( <span class="number">20151</span> * ( <span class="number">5268</span> + ( <span class="number">90693</span> * ( <span class="number">82773</span> + ( <span class="number">716</span> + ( <span class="number">27377</span> * ( <span class="number">44329</span> + ( <span class="number">49366</span> * ( ( ( <span class="number">38790</span> + ( <span class="number">70247</span> * ( <span class="number">97233</span> + ( <span class="number">18347</span> + ( <span class="number">22117</span> * ( ( ( <span class="number">72576</span> + ( ( <span class="number">47541</span> + ( <span class="number">46975</span> + ( <span class="number">53769</span> * ( <span class="number">94005</span> + ( ( <span class="number">72914</span> + ( <span class="number">5137</span> + ( <span class="number">87544</span> * ( ( <span class="number">71583</span> + ( <span class="number">20370</span> + ( <span class="number">37968</span> * ( <span class="number">17478</span> + ( ( <span class="number">40532</span> + ( <span class="number">10089</span> + ( <span class="number">13332</span> * ( ( <span class="number">24170</span> + ( <span class="number">46845</span> * ( <span class="number">16048</span> + ( <span class="number">23142</span> * ( <span class="number">31895</span> + ( <span class="number">62386</span> * ( <span class="number">12179</span> + ( <span class="number">94552</span> + ( ( ( <span class="number">52918</span> + ( <span class="number">91580</span> + ( ( ( <span class="number">38412</span> + ( <span class="number">91537</span> * ( <span class="number">70</span> + ( <span class="number">98594</span> * ( ( <span class="number">35275</span> + ( <span class="number">62912</span> * ( <span class="number">4755</span> + ( <span class="number">16737</span> * ( <span class="number">27595</span> + ( ( <span class="number">43551</span> + ( <span class="number">64482</span> * <span class="number">3550</span> ) ) - <span class="number">21031</span> ) ) ) ) ) ) - <span class="number">57553</span> ) ) ) ) ) - <span class="number">89883</span> ) - <span class="number">38900</span> ) ) ) - <span class="number">19517</span> ) - <span class="number">79082</span> ) ) ) ) ) ) ) ) ) - <span class="number">70643</span> ) ) ) ) - <span class="number">55350</span> ) ) ) ) ) - <span class="number">40301</span> ) ) ) ) - <span class="number">83065</span> ) ) ) ) ) - <span class="number">52460</span> ) ) - <span class="number">49428</span> ) - <span class="number">94686</span> ) ) ) ) ) ) - <span class="number">1653</span> ) - <span class="number">65217</span> ) ) ) ) ) ) ) ) ) ) ) ) ) ) ) - <span class="number">43827</span> ) ) ) ) ) - <span class="number">66562</span> ) ) ) </span><br><span class="line">s=<span class="built_in">hex</span>(a)[<span class="number">2</span>:-<span class="number">1</span>].decode(<span class="string">&#x27;hex&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(s)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>flag:hctf{P0l1sh_Duck_Tast3s_D3l1ci0us_D0_U_Th1nk?}</p>
</blockquote>
<h2 id="spiral">Spiral</h2>
<h3 id="part-a">part A</h3>
<p>IDA打开，定位到main函数。flag由命令行参数传入。<code>sub_122AD87</code>把flag的格式去掉，剩下的部分长度为73。</p>
<p><code>sub_1229E1E</code>把flag分成前46和后27两部分。</p>
<p><code>sub_122F430</code>校验前46，算法比较简单。取每一个字符的低3bit和除符号位的高4bit，根据低3bit对高4bit加/异或，然后把低3bit和操作后的高4bit跟常量对比。低3bit已经给出了，就很好算了，直接求解：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#flag1</span></span><br><span class="line">const=[<span class="number">0x07</span>,<span class="number">0xE7</span>,<span class="number">0x07</span>,<span class="number">0xE4</span>,<span class="number">0x01</span>,<span class="number">0x19</span>,<span class="number">0x03</span>,<span class="number">0x50</span>,<span class="number">0x07</span>,<span class="number">0xE4</span>,<span class="number">0x01</span>,<span class="number">0x20</span>,<span class="number">0x06</span>,<span class="number">0xB7</span>,<span class="number">0x07</span>,<span class="number">0xE4</span>,<span class="number">0x01</span>,<span class="number">0x22</span>,<span class="number">0x00</span>,<span class="number">0x28</span>,<span class="number">0x00</span>,<span class="number">0x2A</span>,<span class="number">0x02</span>,<span class="number">0x54</span>,<span class="number">0x07</span>,<span class="number">0xE4</span>,<span class="number">0x01</span>,<span class="number">0x1F</span>,<span class="number">0x02</span>,<span class="number">0x50</span>,<span class="number">0x05</span>,<span class="number">0xF2</span>,<span class="number">0x04</span>,<span class="number">0xCC</span>,<span class="number">0x07</span>,<span class="number">0xE4</span>,<span class="number">0x00</span>,<span class="number">0x28</span>,<span class="number">0x06</span>,<span class="number">0xB3</span>,<span class="number">0x05</span>,<span class="number">0xF8</span>,<span class="number">0x07</span>,<span class="number">0xE4</span>,<span class="number">0x00</span>,<span class="number">0x28</span>,<span class="number">0x06</span>,<span class="number">0xB2</span>,<span class="number">0x07</span>,<span class="number">0xE4</span>,<span class="number">0x04</span>,<span class="number">0xC0</span>,<span class="number">0x00</span>,<span class="number">0x2F</span>,<span class="number">0x05</span>,<span class="number">0xF8</span>,<span class="number">0x07</span>,<span class="number">0xE4</span>,<span class="number">0x04</span>,<span class="number">0xC0</span>,<span class="number">0x00</span>,<span class="number">0x28</span>,<span class="number">0x05</span>,<span class="number">0xF0</span>,<span class="number">0x07</span>,<span class="number">0xE3</span>,<span class="number">0x00</span>,<span class="number">0x2B</span>,<span class="number">0x04</span>,<span class="number">0xC4</span>,<span class="number">0x05</span>,<span class="number">0xF6</span>,<span class="number">0x03</span>,<span class="number">0x4C</span>,<span class="number">0x04</span>,<span class="number">0xC0</span>,<span class="number">0x07</span>,<span class="number">0xE4</span>,<span class="number">0x05</span>,<span class="number">0xF6</span>,<span class="number">0x06</span>,<span class="number">0xB3</span>,<span class="number">0x01</span>,<span class="number">0x19</span>,<span class="number">0x07</span>,<span class="number">0xE3</span>,<span class="number">0x05</span>,<span class="number">0xF7</span>,<span class="number">0x01</span>,<span class="number">0x1F</span>,<span class="number">0x07</span>,<span class="number">0xE4</span>]</span><br><span class="line">flag1=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">46</span>):</span><br><span class="line">    <span class="keyword">if</span> const[<span class="number">2</span>*i]==<span class="number">0</span>:</span><br><span class="line">        const[<span class="number">2</span>*i+<span class="number">1</span>]-=<span class="number">0x22</span></span><br><span class="line">    <span class="keyword">elif</span> const[<span class="number">2</span>*i]==<span class="number">1</span>: </span><br><span class="line">        const[<span class="number">2</span>*i+<span class="number">1</span>]-=<span class="number">0x13</span></span><br><span class="line">    <span class="keyword">elif</span> const[<span class="number">2</span>*i]==<span class="number">2</span>:</span><br><span class="line">        const[<span class="number">2</span>*i+<span class="number">1</span>]-=<span class="number">0x46</span></span><br><span class="line">    <span class="keyword">elif</span> const[<span class="number">2</span>*i]==<span class="number">3</span>:</span><br><span class="line">        const[<span class="number">2</span>*i+<span class="number">1</span>]-=<span class="number">0x42</span></span><br><span class="line">    <span class="keyword">elif</span> const[<span class="number">2</span>*i]==<span class="number">4</span>:</span><br><span class="line">        const[<span class="number">2</span>*i+<span class="number">1</span>]^=<span class="number">0xCA</span></span><br><span class="line">    <span class="keyword">elif</span> const[<span class="number">2</span>*i]==<span class="number">5</span>:</span><br><span class="line">        const[<span class="number">2</span>*i+<span class="number">1</span>]^=<span class="number">0xFE</span></span><br><span class="line">    <span class="keyword">elif</span> const[<span class="number">2</span>*i]==<span class="number">6</span>:</span><br><span class="line">        const[<span class="number">2</span>*i+<span class="number">1</span>]^=<span class="number">0xBE</span></span><br><span class="line">    <span class="keyword">elif</span> const[<span class="number">2</span>*i]==<span class="number">7</span>:</span><br><span class="line">        const[<span class="number">2</span>*i+<span class="number">1</span>]^=<span class="number">0xEF</span></span><br><span class="line">    flag1+=<span class="built_in">chr</span>(const[<span class="number">2</span>*i+<span class="number">1</span>]&lt;&lt;<span class="number">3</span>|const[<span class="number">2</span>*i])</span><br><span class="line"><span class="built_in">print</span>(flag1)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>G_1s_iN_y0@r_aRe4_0n5_0f_Th5_T0ugHtEST_En1gMa_</p>
</blockquote>
<h3 id="part-b">part B</h3>
<p><code>sub_12283E8</code>在当前磁盘根目录下写了一个文件<code>Spiral_core.sys</code>，连带输入的后27位也写进去。剩下的部分都在这个sys里完成。后面一个函数没怎么看懂，直接去看sys了。</p>
<p>打开源程序，输一个假flag，就能在根目录看到新建的文件了。这是一个驱动程序，<code>DriverEntry</code>是入口函数，主要是在<code>sub_403310</code>。前面几个函数都在读取一些寄存器的值，申请一些内存，不太清楚实在做什么。到了<code>sub_401596</code>发现了vmxon这个指令。查找资料后发现应该跟VMX技术有关，这是一种硬件虚拟化技术，具体怎么实现不太清楚。后面到了<code>sub_402B60</code>中有大量vmwrite等指令，其实这里不用搞懂他在做什么。我当时死扛在这里太久，却没丝毫头绪。后来问了问pizza才知道这里都不需要看，最重要的在中间的一句</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vmwrite(<span class="number">0x6C16</span>, &amp;loc_401738);</span><br></pre></td></tr></table></figure>
<p>IDA并不能很好的识别401738的数据，手动P或者C一下发现这是一串代码。开头的call没什么用，第二个call
<code>sub_402880</code>才是真正核心的地方。</p>
<p>这里面有一个switch，每个case里面又有switch。</p>
<p>回到<code>sub_402B60</code>，最后<code>vmlaunch</code>之后，后续的cpuid，invd，以及返回后下一个函数<code>sub_4030B0</code>里面的vmcall，这些函数已经不是它本身的内容了，全部被虚拟到了
<code>sub_402880</code>里面。cpuid，invd，vmcall对应着这里面这些switch。具体怎么对应可以进入里面看参数。<code>sub_4019A0</code>有0xDEADBEEF，那就对应着cpuid。用汇编看<code>sub_401690</code>可以看到cpuid的参数DEADBEEF是通过eax传递的，，那接下来的invd和rdmsr的参数也是用eax（rdmsr上面有两行，eax才是它的参数）。</p>
<p><code>sub_4019A0</code>里先调用了一个函数<code>sub_402690</code>，用来解密一个常量数组A。</p>
<p>接下来就要根据<code>sub_4019A0</code>，解析所有之前的这些指令。</p>
<p>大致分为四种：</p>
<p>cpuid：对操作码解密</p>
<p>invd：打乱操作码</p>
<p>rdmsr：打乱常量数组A</p>
<p>vmcall：虚拟机操作。</p>
<p>没错了，之前的VMX技术＂重定义＂了这些函数后，形成了一个虚拟机，校验flag过程在这个虚拟机内实现。</p>
<p>之前一串的vmcall就是虚拟机的opcode，我们要把这些opcode解析出来。</p>
<p>这些opcode都是在对常量数组操作，这个数组被之前的调用<code>sub_402690</code>解密后，再通过两个rdmsr，之后就全是vmcall对它的操作了，我们先把vmcall之前的A算出来。</p>
<p>第一个解密函数这里要注意，<code>dword_40502C</code>实际上是数组A地址-1，所以对应A的下标要-1。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">A=[<span class="number">0x7</span>,<span class="number">0x0CE</span>,<span class="number">0x59</span>,<span class="number">0x23</span>,<span class="number">0x9</span>,<span class="number">0x5</span>,<span class="number">0x3</span>,<span class="number">0x1</span>,<span class="number">0x6</span>,<span class="number">0x2</span>,<span class="number">0x6</span>,<span class="number">0x5</span>,<span class="number">0x7D</span>,<span class="number">0x56</span>,<span class="number">0x0F0</span>,<span class="number">0x28</span>,<span class="number">0x4</span>,<span class="number">0x59</span>,<span class="number">0x4D</span>,<span class="number">0x4D</span>,<span class="number">0x4B</span>,<span class="number">0x53</span>,<span class="number">0x9</span>,<span class="number">0x1</span>,<span class="number">0x0F</span>,<span class="number">0x57</span>,<span class="number">0x8</span>,<span class="number">0x0D3</span>,<span class="number">0x38</span>,<span class="number">0x6F</span>,<span class="number">0x299</span>,<span class="number">0x0E1</span>,<span class="number">0x36</span>,<span class="number">0x2</span>,<span class="number">0x76</span>,<span class="number">0x357</span>,<span class="number">0x6A</span>,<span class="number">0x0AA</span>,<span class="number">0x374</span>,<span class="number">0x1A4</span>,<span class="number">0x5D</span>,<span class="number">0x56</span>,<span class="number">0x57</span>,<span class="number">0x7</span>,<span class="number">0x7F</span>,<span class="number">0x8</span>,<span class="number">0x0A8</span>,<span class="number">0x0B0</span>,<span class="number">0x9</span>,<span class="number">0x32</span>,<span class="number">0x2</span>,<span class="number">0x6</span>,<span class="number">0x463</span>,<span class="number">0x469</span>,<span class="number">0x5</span>,<span class="number">0x0C6</span>,<span class="number">0x2</span>,<span class="number">0x25</span>,<span class="number">0x68</span>,<span class="number">0x33</span>,<span class="number">0x32</span>,<span class="number">0x67</span>,<span class="number">0x1</span>,<span class="number">0x71</span>,<span class="number">0x1</span>,<span class="number">0x507</span>,<span class="number">0x63</span>,<span class="number">0x8</span>,<span class="number">0x6</span>,<span class="number">0x0A3</span>,<span class="number">0x5F5</span>,<span class="number">0x6</span>,<span class="number">0x31</span>,<span class="number">0x3B8</span>,<span class="number">0x65</span>,<span class="number">0x200</span>,<span class="number">0x28</span>,<span class="number">0x57</span>,<span class="number">0x1</span>,<span class="number">0xA5</span>,<span class="number">0x09</span>]</span><br><span class="line"></span><br><span class="line">v5 = A[<span class="number">40</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">    A[<span class="number">8</span>*i+<span class="number">40</span>] = A[<span class="number">8</span>*i+<span class="number">40</span>-<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>*i+<span class="number">1</span>):</span><br><span class="line">    	A[<span class="number">3</span>-i+<span class="number">9</span>*(i+<span class="number">4</span>-j)] = A[<span class="number">3</span>-i+<span class="number">9</span>*(i+<span class="number">4</span>-(j+<span class="number">1</span>))]</span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>*i+<span class="number">2</span>):</span><br><span class="line">        A[k+<span class="number">9</span>*(<span class="number">3</span>-i)+<span class="number">3</span>-i] = A[<span class="number">10</span>*(<span class="number">3</span>-i)+k+<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">for</span> l <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>*i+<span class="number">2</span>):</span><br><span class="line">        A[<span class="number">9</span>*(l+<span class="number">3</span>-i)+i+<span class="number">5</span>] = A[<span class="number">9</span>*(<span class="number">3</span>-i+l+<span class="number">1</span>)+i+<span class="number">5</span>]</span><br><span class="line">    <span class="keyword">for</span> m <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>*i+<span class="number">2</span>):</span><br><span class="line">        A[<span class="number">9</span>*(i+<span class="number">5</span>)+i+<span class="number">5</span>-m] = A[<span class="number">9</span>*(i+<span class="number">5</span>)+i+<span class="number">5</span>-(m+<span class="number">1</span>)]</span><br><span class="line">A[<span class="number">72</span>] = v5</span><br><span class="line"></span><br><span class="line"><span class="comment"># rdmsr(0x174)</span></span><br><span class="line">v5 = A[<span class="number">80</span>]</span><br><span class="line">v6 = A[<span class="number">8</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">9</span>)[::-<span class="number">1</span>]:</span><br><span class="line">	A[<span class="number">10</span> * i] = A[<span class="number">9</span> * (i - <span class="number">1</span>) + i - <span class="number">1</span>]</span><br><span class="line">A[<span class="number">0</span>] = v5</span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">9</span>):</span><br><span class="line">	A[<span class="number">8</span> * j] = A[<span class="number">8</span> * j + <span class="number">8</span>]</span><br><span class="line">A[<span class="number">8</span> * (j+<span class="number">1</span>)] = v6</span><br><span class="line"></span><br><span class="line"><span class="comment"># rdmsr(0x176)</span></span><br><span class="line">v2 = A[<span class="number">76</span>]</span><br><span class="line">v3 = A[<span class="number">36</span>]</span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">9</span>)[::-<span class="number">1</span>]:</span><br><span class="line">	A[<span class="number">9</span> * k + <span class="number">4</span>] = A[<span class="number">9</span> * (k - <span class="number">1</span>) + <span class="number">4</span>]</span><br><span class="line">A[<span class="number">4</span>] = v2</span><br><span class="line"><span class="keyword">for</span> l <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">	A[l + <span class="number">36</span>] = A[l + <span class="number">37</span>]</span><br><span class="line">A[<span class="number">44</span>] = v3</span><br><span class="line"><span class="built_in">print</span>(A)</span><br></pre></td></tr></table></figure>
<p>之后解析vmcall。由于每一段vmcall之前都有一个invd，所以要先按他的方式打乱。</p>
<p>最开始是一个cpuid异或操作码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">op=[<span class="number">0xA3</span>,<span class="number">0xF9</span>,<span class="number">0x77</span>,<span class="number">0xA6</span>,<span class="number">0xC1</span>,<span class="number">0xC7</span>,<span class="number">0x4E</span>,<span class="number">0xD1</span>,<span class="number">0x51</span>,<span class="number">0xFF</span>,<span class="number">0x93</span>,<span class="number">0xC8</span>,<span class="number">0x45</span>,<span class="number">0x95</span>,<span class="number">0xF5</span>,<span class="number">0xF2</span>,<span class="number">0x78</span>,<span class="number">0xE6</span>,<span class="number">0x69</span>,<span class="number">0xC6</span>,<span class="number">0x90</span>,<span class="number">0xCD</span>,<span class="number">0x40</span>,<span class="number">0x96</span>,<span class="number">0xF0</span>,<span class="number">0xFE</span>,<span class="number">0x78</span>,<span class="number">0xE3</span>,<span class="number">0x64</span>,<span class="number">0xC7</span>]</span><br><span class="line"><span class="comment"># cpuid(0xDEADBEEF)</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    op[i]^=op[i+<span class="number">20</span>]</span><br></pre></td></tr></table></figure>
<p>接下来打乱，我把三段的操作码分开了。</p>
<p>同样的，解析invd的时候要注意，它有些不是从op开头的数组起点，而是从op前一位<code>dword_405374</code>或前两位作为数组起点的，只需对应op-1就行。</p>
<p>invd(4437)
的后面有个循环比较迷，只有一次，相当于没有循环，但是出循环后计数器还是加了，所以计数器是1不是0。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">	</span><br><span class="line"><span class="comment"># invd(0x4437)</span></span><br><span class="line">v3 = op[<span class="number">7</span>]</span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">	op[k + <span class="number">7</span>] = op[<span class="number">6</span> - k]</span><br><span class="line">	<span class="keyword">if</span> ( k == <span class="number">2</span> ):</span><br><span class="line">		op[<span class="number">6</span> - k] = op[<span class="number">3</span>]</span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		op[<span class="number">6</span> - k] = op[k + <span class="number">8</span>]</span><br><span class="line">op[<span class="number">3</span>] = op[<span class="number">1</span>]</span><br><span class="line">op[<span class="number">1</span>] = op[<span class="number">2</span>]</span><br><span class="line">op[<span class="number">1</span>] = v3</span><br><span class="line"></span><br><span class="line"><span class="comment"># invd(0x4433)</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">    v0 = op[<span class="number">2</span> * i]</span><br><span class="line">    op[<span class="number">2</span> * i] = op[<span class="number">2</span> * i + <span class="number">1</span>]</span><br><span class="line">    op[<span class="number">2</span> * i + <span class="number">1</span>] = v0</span><br><span class="line">op0=op[<span class="number">0</span>:<span class="number">10</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># invd(0x4434)</span></span><br><span class="line">v5 = op[<span class="number">0</span>]</span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>):</span><br><span class="line">	op[j] = op[j + <span class="number">1</span>]</span><br><span class="line">op[<span class="number">9</span>] = v5</span><br><span class="line">op1=op[<span class="number">0</span>:<span class="number">10</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># invd(4437)</span></span><br><span class="line">v3 = op[<span class="number">7</span>]</span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">	op[k + <span class="number">7</span>] = op[<span class="number">6</span> - k]</span><br><span class="line">	<span class="keyword">if</span> ( k == <span class="number">2</span> ):</span><br><span class="line">		op[<span class="number">6</span> - k] = op[<span class="number">3</span>]</span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		op[<span class="number">6</span> - k] = op[k + <span class="number">8</span>]</span><br><span class="line">op[<span class="number">3</span>] = op[<span class="number">1</span>]</span><br><span class="line">op[<span class="number">1</span>] = op[<span class="number">2</span>]</span><br><span class="line">op[<span class="number">1</span>] = v3</span><br><span class="line">op2=op[<span class="number">0</span>:<span class="number">10</span>]</span><br><span class="line">opa=[op0,op1,op2]</span><br></pre></td></tr></table></figure>
<p>然后就可以解析vmcode了。根据<code>sub_401C40</code>，最高两位对比操作码，决定何种操作，次两位定位一个数组A中的位置，再过来两位是否为CC决定输入字符串是否倒序，最后两位定位输入字符串的一个字符。</p>
<p>解析代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># get the operation</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):    </span><br><span class="line">    op=opa[i]</span><br><span class="line">    <span class="keyword">for</span> opcode <span class="keyword">in</span> O[i]:</span><br><span class="line">        v1 = opcode &gt;&gt; <span class="number">24</span></span><br><span class="line">        v2 = ((opcode&gt;&gt;<span class="number">16</span>) &amp; <span class="number">0xF</span>) + <span class="number">9</span> * ((opcode&gt;&gt;<span class="number">20</span>)&amp;<span class="number">0xF</span>)</span><br><span class="line">		v3 = (opcode&amp;<span class="number">0xff</span>)</span><br><span class="line">        <span class="keyword">if</span> ( ((opcode&gt;&gt;<span class="number">8</span>)&amp;<span class="number">0xff</span>) == <span class="number">0xCC</span> ):</span><br><span class="line">            t=opcode&amp;<span class="number">0xff</span></span><br><span class="line">            t1=v3-<span class="number">1</span></span><br><span class="line">            t2=v3+<span class="number">1</span></span><br><span class="line">            t3=v3-<span class="number">2</span></span><br><span class="line">            t4=v3+<span class="number">2</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            t=<span class="number">26</span>-v3</span><br><span class="line">            t1=<span class="number">26</span>-(v3-<span class="number">1</span>)</span><br><span class="line">            t2=<span class="number">26</span>-(v3+<span class="number">1</span>)</span><br><span class="line">            t3=<span class="number">26</span>-(v3-<span class="number">2</span>)</span><br><span class="line">            t4=<span class="number">26</span>-(v3+<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> ( v1 == op[<span class="number">0</span>] ):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;A[%d]=x[%d]&quot;</span>%(v2,t))</span><br><span class="line">        <span class="keyword">elif</span> ( v1 == op[<span class="number">1</span>] ):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;A[%d]=(A[%d]+x[%d])&amp;0xFF&quot;</span>%(v2,v2,t))</span><br><span class="line">        <span class="keyword">elif</span> ( v1 == op[<span class="number">2</span>] ):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;A[%d]=(A[%d]-x[%d])&amp;0xFF&quot;</span>%(v2,v2,t))</span><br><span class="line">        <span class="keyword">elif</span> ( v1 == op[<span class="number">3</span>] ):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;A[%d]=(A[%d]/x[%d])&amp;0xFF&quot;</span>%(v2,v2,t))</span><br><span class="line">        <span class="keyword">elif</span> ( v1 == op[<span class="number">4</span>] ):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;A[%d]=(A[%d]*x[%d])&amp;0xFF&quot;</span>%(v2,v2,t))</span><br><span class="line">        <span class="keyword">elif</span> ( v1 == op[<span class="number">5</span>] ):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;A[%d]=(A[%d]^x[%d])&amp;0xFF&quot;</span>%(v2,v2,t))</span><br><span class="line">        <span class="keyword">elif</span> ( v1 == op[<span class="number">6</span>] ):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;A[%d]=(A[%d]^(x[%d]+x[%d]-x[%d]))&amp;0xFF&quot;</span>%(v2,v2,t1,t,t2))</span><br><span class="line">        <span class="keyword">elif</span> ( v1 == op[<span class="number">7</span>] ):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;A[%d]=(A[%d]^(x[%d]&lt;&lt;4))&amp;0xFF&quot;</span>%(v2,v2,t))</span><br><span class="line">        <span class="keyword">elif</span> ( v1 == op[<span class="number">8</span>] ):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;A[%d]=(A[%d]|x[%d])&amp;0xFF&quot;</span>%(v2,v2,t))</span><br><span class="line">        <span class="keyword">elif</span> ( v1 == op[<span class="number">9</span>] ):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;A[%d]=(A[%d]^(x[%d]^x[%d]^x[%d]+x[%d]-x[%d]))&amp;0xFF&quot;</span>%(v2,v2,t2,t1,t3,t,t4))</span><br><span class="line">    <span class="built_in">print</span>()</span><br></pre></td></tr></table></figure>
<p>最后一个vmcall是校验过程<code>sub_401960</code>。这个校验很奇怪，虽然循环是9个，但每次调用的函数的参数都是1，怀疑出了问题。校验函数的内容就是根据一个table把A转成一个9*9矩阵每一行都是1到9的范围内且不相同。（很像数独，虽然只有行）</p>
<p>有了算法和校验，算法这么复杂，逆估计是逆不动了，z3启动！</p>
<p>A是最开始算出来的，那一串操作是刚刚解析的，至于那个while(1):只是因为想在ide里面把它作为代码块缩略=
=</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">A=[<span class="number">165</span>,<span class="number">89</span>,<span class="number">35</span>,<span class="number">9</span>,<span class="number">512</span>,<span class="number">3</span>,<span class="number">1</span>,<span class="number">6</span>,<span class="number">87</span>,<span class="number">7</span>,<span class="number">206</span>,<span class="number">125</span>,<span class="number">86</span>,<span class="number">5</span>,<span class="number">40</span>,<span class="number">4</span>,<span class="number">2</span>,<span class="number">8</span>,<span class="number">2</span>,<span class="number">6</span>,<span class="number">5</span>,<span class="number">9</span>,<span class="number">240</span>,<span class="number">15</span>,<span class="number">86</span>,<span class="number">118</span>,<span class="number">855</span>,<span class="number">77</span>,<span class="number">77</span>,<span class="number">75</span>,<span class="number">83</span>,<span class="number">1</span>,<span class="number">225</span>,<span class="number">87</span>,<span class="number">7</span>,<span class="number">127</span>,<span class="number">56</span>,<span class="number">111</span>,<span class="number">665</span>,<span class="number">54</span>,<span class="number">2</span>,<span class="number">6</span>,<span class="number">1123</span>,<span class="number">1129</span>,<span class="number">211</span>,<span class="number">106</span>,<span class="number">170</span>,<span class="number">884</span>,<span class="number">198</span>,<span class="number">176</span>,<span class="number">420</span>,<span class="number">50</span>,<span class="number">103</span>,<span class="number">1</span>,<span class="number">8</span>,<span class="number">168</span>,<span class="number">113</span>,<span class="number">2</span>,<span class="number">9</span>,<span class="number">104</span>,<span class="number">50</span>,<span class="number">1525</span>,<span class="number">6</span>,<span class="number">5</span>,<span class="number">93</span>,<span class="number">1</span>,<span class="number">1287</span>,<span class="number">37</span>,<span class="number">8</span>,<span class="number">6</span>,<span class="number">51</span>,<span class="number">9</span>,<span class="number">89</span>,<span class="number">49</span>,<span class="number">952</span>,<span class="number">101</span>,<span class="number">99</span>,<span class="number">40</span>,<span class="number">87</span>,<span class="number">1</span>,<span class="number">163</span>]</span><br><span class="line">table=[[<span class="number">0x0</span>,<span class="number">0x1</span>,<span class="number">0x2</span>,<span class="number">0x3</span>,<span class="number">0x12</span>,<span class="number">0x13</span>,<span class="number">0x14</span>,<span class="number">0x23</span>,<span class="number">0x24</span>],[<span class="number">0x4</span>,<span class="number">0x5</span>,<span class="number">0x6</span>,<span class="number">0x7</span>,<span class="number">0x8</span>,<span class="number">0x15</span>,<span class="number">0x17</span>,<span class="number">0x27</span>,<span class="number">0x37</span>],[<span class="number">0x10</span>,<span class="number">0x20</span>,<span class="number">0x30</span>,<span class="number">0x31</span>,<span class="number">0x40</span>,<span class="number">0x50</span>,<span class="number">0x51</span>,<span class="number">0x52</span>,<span class="number">0x60</span>],[<span class="number">0x11</span>,<span class="number">0x21</span>,<span class="number">0x22</span>,<span class="number">0x32</span>,<span class="number">0x33</span>,<span class="number">0x34</span>,<span class="number">0x35</span>,<span class="number">0x41</span>,<span class="number">0x42</span>],[<span class="number">0x16</span>,<span class="number">0x25</span>,<span class="number">0x26</span>,<span class="number">0x36</span>,<span class="number">0x43</span>,<span class="number">0x44</span>,<span class="number">0x45</span>,<span class="number">0x46</span>,<span class="number">0x54</span>],[<span class="number">0x18</span>,<span class="number">0x28</span>,<span class="number">0x38</span>,<span class="number">0x48</span>,<span class="number">0x58</span>,<span class="number">0x67</span>,<span class="number">0x68</span>,<span class="number">0x78</span>,<span class="number">0x88</span>],[<span class="number">0x47</span>,<span class="number">0x55</span>,<span class="number">0x56</span>,<span class="number">0x57</span>,<span class="number">0x65</span>,<span class="number">0x66</span>,<span class="number">0x76</span>,<span class="number">0x77</span>,<span class="number">0x87</span>],[<span class="number">0x53</span>,<span class="number">0x62</span>,<span class="number">0x63</span>,<span class="number">0x64</span>,<span class="number">0x72</span>,<span class="number">0x74</span>,<span class="number">0x75</span>,<span class="number">0x85</span>,<span class="number">0x86</span>],[<span class="number">0x61</span>,<span class="number">0x70</span>,<span class="number">0x71</span>,<span class="number">0x73</span>,<span class="number">0x80</span>,<span class="number">0x81</span>,<span class="number">0x82</span>,<span class="number">0x83</span>,<span class="number">0x84</span>]]</span><br><span class="line">x=[BitVec(<span class="string">&#x27;x%d&#x27;</span>%i,<span class="number">16</span>)<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">27</span>)]</span><br><span class="line">s=Solver()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">27</span>):</span><br><span class="line">    s.add(And(x[i]&gt;=<span class="number">0x20</span>,x[i]&lt;=<span class="number">0x7F</span>))</span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">	A[<span class="number">12</span>]=(A[<span class="number">12</span>]^x[<span class="number">23</span>])&amp;<span class="number">0xFF</span></span><br><span class="line">	A[<span class="number">1</span>]=(A[<span class="number">1</span>]-x[<span class="number">1</span>])&amp;<span class="number">0xFF</span></span><br><span class="line">	A[<span class="number">29</span>]=(A[<span class="number">29</span>]^(x[<span class="number">18</span>]+x[<span class="number">17</span>]-x[<span class="number">16</span>]))&amp;<span class="number">0xFF</span></span><br><span class="line">	A[<span class="number">0</span>]=(A[<span class="number">0</span>]+x[<span class="number">0</span>])&amp;<span class="number">0xFF</span></span><br><span class="line">	A[<span class="number">14</span>]=(A[<span class="number">14</span>]^x[<span class="number">4</span>])&amp;<span class="number">0xFF</span></span><br><span class="line">	A[<span class="number">26</span>]=(A[<span class="number">26</span>]^(x[<span class="number">19</span>]&lt;&lt;<span class="number">4</span>))&amp;<span class="number">0xFF</span></span><br><span class="line">	A[<span class="number">25</span>]=(A[<span class="number">25</span>]^x[<span class="number">6</span>])&amp;<span class="number">0xFF</span></span><br><span class="line">	A[<span class="number">11</span>]=(A[<span class="number">11</span>]-x[<span class="number">3</span>])&amp;<span class="number">0xFF</span></span><br><span class="line">	A[<span class="number">24</span>]=(A[<span class="number">24</span>]^x[<span class="number">20</span>])&amp;<span class="number">0xFF</span></span><br><span class="line">	A[<span class="number">8</span>]=(A[<span class="number">8</span>]-x[<span class="number">25</span>])&amp;<span class="number">0xFF</span></span><br><span class="line">	A[<span class="number">10</span>]=(A[<span class="number">10</span>]+x[<span class="number">24</span>])&amp;<span class="number">0xFF</span></span><br><span class="line">	A[<span class="number">23</span>]=(A[<span class="number">23</span>]^(x[<span class="number">4</span>]+x[<span class="number">5</span>]-x[<span class="number">6</span>]))&amp;<span class="number">0xFF</span></span><br><span class="line">	A[<span class="number">27</span>]=(A[<span class="number">27</span>]^(x[<span class="number">8</span>]^x[<span class="number">6</span>]^x[<span class="number">5</span>]+x[<span class="number">7</span>]-x[<span class="number">9</span>]))&amp;<span class="number">0xFF</span></span><br><span class="line">	A[<span class="number">22</span>]=(A[<span class="number">22</span>]/x[<span class="number">21</span>])&amp;<span class="number">0xFF</span></span><br><span class="line">	A[<span class="number">2</span>]=(A[<span class="number">2</span>]-x[<span class="number">26</span>])&amp;<span class="number">0xFF</span></span><br><span class="line">	A[<span class="number">21</span>]=(A[<span class="number">21</span>]^(x[<span class="number">21</span>]^x[<span class="number">23</span>]^x[<span class="number">24</span>]+x[<span class="number">22</span>]-x[<span class="number">20</span>]))&amp;<span class="number">0xFF</span></span><br><span class="line">	A[<span class="number">28</span>]=(A[<span class="number">28</span>]-x[<span class="number">18</span>])&amp;<span class="number">0xFF</span></span><br><span class="line">	A[<span class="number">4</span>]=(A[<span class="number">4</span>]/x[<span class="number">2</span>])&amp;<span class="number">0xFF</span></span><br><span class="line">	</span><br><span class="line">	A[<span class="number">48</span>]=(A[<span class="number">48</span>]/x[<span class="number">9</span>])&amp;<span class="number">0xFF</span></span><br><span class="line">	A[<span class="number">32</span>]=(A[<span class="number">32</span>]+x[<span class="number">9</span>])&amp;<span class="number">0xFF</span></span><br><span class="line">	A[<span class="number">38</span>]=(A[<span class="number">38</span>]/x[<span class="number">10</span>])&amp;<span class="number">0xFF</span></span><br><span class="line">	A[<span class="number">35</span>]=(A[<span class="number">35</span>]^(x[<span class="number">16</span>]+x[<span class="number">15</span>]-x[<span class="number">14</span>]))&amp;<span class="number">0xFF</span></span><br><span class="line">	A[<span class="number">45</span>]=(A[<span class="number">45</span>]-x[<span class="number">13</span>])&amp;<span class="number">0xFF</span></span><br><span class="line">	A[<span class="number">37</span>]=(A[<span class="number">37</span>]^x[<span class="number">13</span>])&amp;<span class="number">0xFF</span></span><br><span class="line">	A[<span class="number">50</span>]=(A[<span class="number">50</span>]/x[<span class="number">15</span>])&amp;<span class="number">0xFF</span></span><br><span class="line">	A[<span class="number">52</span>]=(A[<span class="number">52</span>]-x[<span class="number">16</span>])&amp;<span class="number">0xFF</span></span><br><span class="line">	A[<span class="number">36</span>]=(A[<span class="number">36</span>]-x[<span class="number">14</span>])&amp;<span class="number">0xFF</span></span><br><span class="line">	A[<span class="number">43</span>]=(A[<span class="number">43</span>]^(x[<span class="number">11</span>]&lt;&lt;<span class="number">4</span>))&amp;<span class="number">0xFF</span></span><br><span class="line">	A[<span class="number">42</span>]=(A[<span class="number">42</span>]^(x[<span class="number">11</span>]&lt;&lt;<span class="number">4</span>))&amp;<span class="number">0xFF</span></span><br><span class="line">	A[<span class="number">39</span>]=(A[<span class="number">39</span>]-x[<span class="number">12</span>])&amp;<span class="number">0xFF</span></span><br><span class="line">	A[<span class="number">33</span>]=(A[<span class="number">33</span>]^x[<span class="number">16</span>])&amp;<span class="number">0xFF</span></span><br><span class="line">	A[<span class="number">47</span>]=(A[<span class="number">47</span>]^(x[<span class="number">14</span>]&lt;&lt;<span class="number">4</span>))&amp;<span class="number">0xFF</span></span><br><span class="line">	A[<span class="number">49</span>]=(A[<span class="number">49</span>]+x[<span class="number">8</span>])&amp;<span class="number">0xFF</span></span><br><span class="line">	A[<span class="number">46</span>]=(A[<span class="number">46</span>]+x[<span class="number">10</span>])&amp;<span class="number">0xFF</span></span><br><span class="line">	A[<span class="number">44</span>]=(A[<span class="number">44</span>]+x[<span class="number">12</span>])&amp;<span class="number">0xFF</span></span><br><span class="line">	A[<span class="number">30</span>]=(A[<span class="number">30</span>]^x[<span class="number">8</span>])&amp;<span class="number">0xFF</span></span><br><span class="line">	</span><br><span class="line">	A[<span class="number">72</span>]=(A[<span class="number">72</span>]^(x[<span class="number">24</span>]^x[<span class="number">22</span>]^x[<span class="number">21</span>]+x[<span class="number">23</span>]-x[<span class="number">25</span>]))&amp;<span class="number">0xFF</span></span><br><span class="line">	A[<span class="number">67</span>]=(A[<span class="number">67</span>]-x[<span class="number">4</span>])&amp;<span class="number">0xFF</span></span><br><span class="line">	A[<span class="number">64</span>]=(A[<span class="number">64</span>]^x[<span class="number">20</span>])&amp;<span class="number">0xFF</span></span><br><span class="line">	A[<span class="number">75</span>]=(A[<span class="number">75</span>]^(x[<span class="number">24</span>]+x[<span class="number">25</span>]-x[<span class="number">26</span>]))&amp;<span class="number">0xFF</span></span><br><span class="line">	A[<span class="number">74</span>]=(A[<span class="number">74</span>]/x[<span class="number">3</span>])&amp;<span class="number">0xFF</span></span><br><span class="line">	A[<span class="number">61</span>]=(A[<span class="number">61</span>]^(x[<span class="number">5</span>]&lt;&lt;<span class="number">4</span>))&amp;<span class="number">0xFF</span></span><br><span class="line">	A[<span class="number">80</span>]=(A[<span class="number">80</span>]+x[<span class="number">0</span>])&amp;<span class="number">0xFF</span></span><br><span class="line">	A[<span class="number">59</span>]=(A[<span class="number">59</span>]^(x[<span class="number">17</span>]+x[<span class="number">18</span>]-x[<span class="number">19</span>]))&amp;<span class="number">0xFF</span></span><br><span class="line">	A[<span class="number">78</span>]=(A[<span class="number">78</span>]^x[<span class="number">1</span>])&amp;<span class="number">0xFF</span></span><br><span class="line">	A[<span class="number">77</span>]=(A[<span class="number">77</span>]-x[<span class="number">26</span>])&amp;<span class="number">0xFF</span></span><br><span class="line">	A[<span class="number">73</span>]=(A[<span class="number">73</span>]^x[<span class="number">24</span>])&amp;<span class="number">0xFF</span></span><br><span class="line">	A[<span class="number">56</span>]=(A[<span class="number">56</span>]^x[<span class="number">6</span>])&amp;<span class="number">0xFF</span></span><br><span class="line">	A[<span class="number">66</span>]=(A[<span class="number">66</span>]^(x[<span class="number">21</span>]&lt;&lt;<span class="number">4</span>))&amp;<span class="number">0xFF</span></span><br><span class="line">	A[<span class="number">51</span>]=(A[<span class="number">51</span>]-x[<span class="number">7</span>])&amp;<span class="number">0xFF</span></span><br><span class="line">	A[<span class="number">55</span>]=(A[<span class="number">55</span>]+x[<span class="number">17</span>])&amp;<span class="number">0xFF</span></span><br><span class="line">	A[<span class="number">60</span>]=(A[<span class="number">60</span>]^x[<span class="number">19</span>])&amp;<span class="number">0xFF</span></span><br><span class="line">	A[<span class="number">76</span>]=(A[<span class="number">76</span>]^(x[<span class="number">3</span>]+x[<span class="number">2</span>]-x[<span class="number">1</span>]))&amp;<span class="number">0xFF</span></span><br><span class="line">	A[<span class="number">70</span>]=(A[<span class="number">70</span>]-x[<span class="number">22</span>])&amp;<span class="number">0xFF</span></span><br><span class="line">	<span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> n <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>):</span><br><span class="line">    t=[<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>):</span><br><span class="line">       t[i]=A[(table[n][i]&amp;<span class="number">0xF</span>)+<span class="number">9</span>*((table[n][i]&gt;&gt;<span class="number">4</span>)&amp;<span class="number">0xF</span>)]</span><br><span class="line">       s.add(And(t[i]&gt;=<span class="number">1</span>,t[i]&lt;=<span class="number">9</span>))</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(j+<span class="number">1</span>,<span class="number">9</span>):</span><br><span class="line">            s.add(t[j]!=t[k])</span><br><span class="line">			</span><br><span class="line"><span class="keyword">assert</span>(s.check()==sat)</span><br><span class="line">m=s.model()</span><br><span class="line">flag2=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> x:</span><br><span class="line">    flag2+=<span class="built_in">chr</span>(m[i].as_long())</span><br><span class="line">flag=<span class="string">&quot;hctf&#123;&quot;</span>+flag1+flag2+<span class="string">&quot;&#125;&quot;</span></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>
<p>历尽千辛，终于解出，鼓掌撒花！</p>

    </div>

    
    
    

    <footer class="post-footer">
          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>本文作者： </strong>Apeng
  </li>
  <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="http://apeng.re/2018/11/13/2018hctf/" title="2018 HCTF 线上赛">http://apeng.re/2018/11/13/2018hctf/</a>
  </li>
  <li class="post-copyright-license">
      <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/deed.zh" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-ND</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

          <div class="post-tags">
              <a href="/tags/SMC/" rel="tag"># SMC</a>
              <a href="/tags/%E5%8F%8D%E8%B0%83%E8%AF%95/" rel="tag"># 反调试</a>
              <a href="/tags/%E9%A9%B1%E5%8A%A8/" rel="tag"># 驱动</a>
              <a href="/tags/AVR/" rel="tag"># AVR</a>
              <a href="/tags/VM/" rel="tag"># VM</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2018/10/29/2018hjb/" rel="prev" title="2018 上海骇极杯">
                  <i class="fa fa-angle-left"></i> 2018 上海骇极杯
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2018/11/20/2018lctf/" rel="next" title="2018 LCTF">
                  2018 LCTF <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2023</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Apeng</span>
  </div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

  <a href="https://github.com/Apeng7364" class="github-corner" title="在 GitHub 上关注我" aria-label="在 GitHub 上关注我" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script>

  






  




  

  <script class="next-config" data-name="enableMath" type="application/json">false</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>



</body>
</html>
