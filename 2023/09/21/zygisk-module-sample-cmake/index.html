<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"apeng.re","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.18.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="zygisk 的示例模块 zygisk-module-sample 由 ndk-build 进行构建。本文讲述如何使用 cmake 构建一个 zygisk 模块。">
<meta property="og:type" content="article">
<meta property="og:title" content="将 zygisk-module-sample 迁移至 cmake">
<meta property="og:url" content="http://apeng.re/2023/09/21/zygisk-module-sample-cmake/index.html">
<meta property="og:site_name" content="Apeng&#39;s blog">
<meta property="og:description" content="zygisk 的示例模块 zygisk-module-sample 由 ndk-build 进行构建。本文讲述如何使用 cmake 构建一个 zygisk 模块。">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2023-09-21T12:10:04.000Z">
<meta property="article:modified_time" content="2023-09-21T13:19:12.413Z">
<meta property="article:author" content="Apeng">
<meta property="article:tag" content="Android">
<meta property="article:tag" content="zygisk">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://apeng.re/2023/09/21/zygisk-module-sample-cmake/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://apeng.re/2023/09/21/zygisk-module-sample-cmake/","path":"/2023/09/21/zygisk-module-sample-cmake/","title":"将 zygisk-module-sample 迁移至 cmake"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>将 zygisk-module-sample 迁移至 cmake | Apeng's blog</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="Apeng's blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Apeng's blog</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Reverse Everything</p>
      <img class="custom-logo-image" src="/uploads/custom-logo.png" alt="Apeng's blog">
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-ndk-%E6%9E%84%E5%BB%BA"><span class="nav-number">1.</span> <span class="nav-text">使用 ndk 构建</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-cmake-%E6%9E%84%E5%BB%BA"><span class="nav-number">2.</span> <span class="nav-text">使用 cmake 构建</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#cmake-%E9%9B%86%E6%88%90-android-ndk-%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE"><span class="nav-number">2.1.</span> <span class="nav-text">CMake 集成 Android NDK
环境配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cstl"><span class="nav-number">2.2.</span> <span class="nav-text">C++STL</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E9%A2%84%E7%BC%96%E8%AF%91-libcxx"><span class="nav-number">2.2.1.</span> <span class="nav-text">使用预编译 libcxx</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-libcxx-%E6%BA%90%E7%A0%81"><span class="nav-number">2.2.2.</span> <span class="nav-text">使用 libcxx 源码</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-number">2.3.</span> <span class="nav-text">总结</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Apeng</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">30</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">59</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/Apeng7364" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Apeng7364" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:apeng622@gmail.com" title="E-Mail → mailto:apeng622@gmail.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/Apeng_7364" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;Apeng_7364" rel="noopener me" target="_blank"><i class="fab fa-twitter fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="/atom.xml" title="RSS → &#x2F;atom.xml" rel="noopener me"><i class="fa fa-rss fa-fw"></i></a>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/deed.zh" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/big/by_nc_nd.svg" alt="Creative Commons"></a>
  </div>

        </div>
      </div>
    </div>

    
    <div class="sidebar-inner sidebar-blogroll">
      <div class="links-of-blogroll animated">
        <div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i>
          链接
        </div>
        <ul class="links-of-blogroll-list">
            <li class="links-of-blogroll-item">
              <a href="/friends" title="&#x2F;friends">Friends</a>
            </li>
        </ul>
      </div>
    </div>
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://apeng.re/2023/09/21/zygisk-module-sample-cmake/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Apeng">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Apeng's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="将 zygisk-module-sample 迁移至 cmake | Apeng's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          将 zygisk-module-sample 迁移至 cmake
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2023-09-21 20:10:04 / 修改时间：21:19:12" itemprop="dateCreated datePublished" datetime="2023-09-21T20:10:04+08:00">2023-09-21</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p>zygisk 的示例模块 <a target="_blank" rel="noopener" href="https://github.com/topjohnwu/zygisk-module-sample.git">zygisk-module-sample</a>
由 ndk-build 进行构建。本文讲述如何使用 cmake 构建一个 zygisk 模块。</p>
<span id="more"></span>
<h2 id="使用-ndk-构建">使用 ndk 构建</h2>
<p>我们先看下官方的构建方法：</p>
<p>克隆项目</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/topjohnwu/zygisk-module-sample.git</span><br></pre></td></tr></table></figure>
<p>项目根目录中有 gradle 配置。但是<strong>不要</strong>用这个 gradle
构建模块，因为里面没有包含 native 的构建配置。 根据 README 中的 Building
提示，我们直接进入 module 文件夹，执行 <code>ndk-build</code> 即可。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd module</span><br><span class="line">ndk-build -j$(nproc) # windows 平台不要用 -j 参数</span><br></pre></td></tr></table></figure>
<p>和普通的 ndk-build 项目一样，编译产物在 <code>module/libs</code>
中。</p>
<p>接下来我们看下 ndk-build 项目的一些配置：</p>
<p>Application.mk:</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">APP_ABI      := armeabi-v7a arm64-v8a x86 x86_64</span><br><span class="line">APP_CPPFLAGS := -std=c++17 -fno-exceptions -fno-rtti -fvisibility=hidden -fvisibility-inlines-hidden</span><br><span class="line">APP_STL      := none</span><br><span class="line">APP_PLATFORM := android-21</span><br></pre></td></tr></table></figure>
<p>Application.mk 中设置了
<code>APP_ABI</code>、<code>APP_CPPFLAGS</code>、<code>APP_STL</code> 和
<code>APP_PLATFORM</code>。<code>APP_ABI</code>和<code>APP_PLATFORM</code>我们按需正常设置即可。比较关键的是
<code>APP_CPPFLAGS</code> 和 <code>APP_STL</code>。</p>
<p><code>APP_CPPFLAGS</code>
设置了若干编译参数。下文将叙述如何正确的设置这些参数。</p>
<p>关于 <code>APP_STL</code>，README 中是这样说的：</p>
<ul>
<li>The <code>APP_STL</code> variable in <code>Application.mk</code> is
set to <code>none</code>. <strong>DO NOT</strong> use any C++ STL
included in NDK.</li>
<li>If you'd like to use C++ STL, you <strong>have to</strong> use the
<code>libcxx</code> included as a git submodule in this repository.
Zygisk modules' code are injected into Zygote, and the included
<code>libc++</code> is setup to be lightweight and fully self contained
that prevents conflicts with the hosting program.</li>
<li>If you do not need STL, link to the system <code>libstdc++</code> so
that you can at least call the <code>new</code> operator.</li>
<li>Both configurations are demonstrated in the example
<code>Android.mk</code>.</li>
</ul>
<p>个人理解，这里的 <em>hosting program</em> 应该指的是 zygote fork
的子进程。一般的 app 都不会使用系统的 libc++，而是使用 ndk 中的
libc++。如果编译 zygisk 模块时又引入了新的
libc++，可能就会引起冲突。</p>
<p>示例所说的两种配置在 <code>Android.mk</code>
文件中。根据实际的情况选择对应的配置，注释或删除掉另一种即可</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">LOCAL_PATH := <span class="variable">$(<span class="built_in">call</span> my-<span class="built_in">dir</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span> <span class="variable">$(CLEAR_VARS)</span></span><br><span class="line">LOCAL_MODULE := example</span><br><span class="line">LOCAL_SRC_FILES := example.cpp</span><br><span class="line">LOCAL_STATIC_LIBRARIES := libcxx</span><br><span class="line">LOCAL_LDLIBS := -llog</span><br><span class="line"><span class="keyword">include</span> <span class="variable">$(BUILD_SHARED_LIBRARY)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span> jni/libcxx/Android.mk</span><br><span class="line"></span><br><span class="line"><span class="comment"># If you do not want to use libc++, link to system stdc++</span></span><br><span class="line"><span class="comment"># so that you can at least call the new operator in your code</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># include $(CLEAR_VARS)</span></span><br><span class="line"><span class="comment"># LOCAL_MODULE := example</span></span><br><span class="line"><span class="comment"># LOCAL_SRC_FILES := example.cpp</span></span><br><span class="line"><span class="comment"># LOCAL_LDLIBS := -llog -lstdc++</span></span><br><span class="line"><span class="comment"># include $(BUILD_SHARED_LIBRARY)</span></span><br></pre></td></tr></table></figure>
<h2 id="使用-cmake-构建">使用 cmake 构建</h2>
<h3 id="cmake-集成-android-ndk-环境配置">CMake 集成 Android NDK
环境配置</h3>
<p>查阅 <a target="_blank" rel="noopener" href="https://developer.android.com/ndk/guides/cmake">Google
的文档</a>以及 <a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/manual/cmake-toolchains.7.html#cross-compiling-for-android">CMake
的文档</a>，我们会发现 Google 和 CMake 有两套不同的构建方式。Google
文档中是这样写的：</p>
<blockquote>
<p>CMake 拥有自己的内置 NDK 支持。在 CMake 3.21 之前，此工作流程不受
Android 支持，并且经常会被新的 NDK 版本中断。从 CMake 3.21
开始，这些实现将被合并。CMake 的内置支持与 NDK
工具链文件具有类似的行为，但变量名称有所不同。从 Android NDK r23
开始，工具链文件将在使用 CMake 3.21 或更高版本时委托给 CMake
的内置支持。 如需了解详情，请参阅问题 463。请注意，Android Gradle
插件仍会自动使用 NDK 的工具链文件。</p>
</blockquote>
<p>因此，强烈建议使用 CMake 3.21 或更高版本，并且使用 CMake 的内置 NDK
支持，不要用 ndk 中的 CMake 工具链文件。</p>
<p>而根据所使用的开发环境的不同，CMake
又有<code>Visual Studio Generators</code> 和
<code>Makefile Generators/Ninja Generators</code>
两种配置方法。本文仅介绍
<code>Makefile Generators/Ninja Generators</code> 的配置方法。</p>
<p>而对于 <code>Makefile Generators/Ninja Generators</code>，又分为 <a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/manual/cmake-toolchains.7.html#cross-compiling-for-android-with-the-ndk">NDK</a>和<a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/manual/cmake-toolchains.7.html#cross-compiling-for-android-with-a-standalone-toolchain">独立工具连</a>两种配置方式。本文仅介绍
NDK 的配置方法。（通常情况下，你应该使用 NDK
的配置方法。独立工具链只适用于 r18 或更低版本的ndk,
r19以上版本已弃用，详见<a target="_blank" rel="noopener" href="https://developer.android.com/ndk/guides/standalone_toolchain">独立工具链</a>）。</p>
<p>根据 CMake 文档以及 zygisk 模板的
<code>Application.mk</code>，我们可能会编写出如下<code>CMakeLists.txt</code>：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.26</span>)</span><br><span class="line"><span class="keyword">project</span>(zygisk_module_sample_cmake)</span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_STANDARD <span class="number">17</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span>(CMAKE_SYSTEM_NAME Android)</span><br><span class="line"><span class="keyword">set</span>(CMAKE_ANDROID_NDK /path/to/ndk)</span><br><span class="line"><span class="keyword">set</span>(CMAKE_SYSTEM_VERSION <span class="number">21</span>)</span><br><span class="line"><span class="keyword">set</span>(CMAKE_ANDROID_ARCH_ABI arm64-v8a)</span><br><span class="line"><span class="keyword">set</span>(CMAKE_ANDROID_STL_TYPE none)</span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_FLAGS <span class="string">&quot;-std=c++17 -fno-exceptions -fno-rtti -fvisibility=hidden -fvisibility-inlines-hidden&quot;</span>)</span><br><span class="line"><span class="comment"># ...</span></span><br></pre></td></tr></table></figure>
<p>然而这样并不能正确的生成。原因在于 CMake
执行后已经初始化好了环境信息，<code>CMakeLists.txt</code>
中设置的变量无效了。事实上，所有这些<a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/manual/cmake-variables.7.html#variables-that-control-the-build">控制构建的变量</a>都不应放到
<code>CMakeLists.txt</code> 中，应该写入一个工具链文件中，然后通过
<code>CMAKE_TOOLCHIAN_FILE</code>
指定工具链文件；或是直接在命令行参数中指定所有的参数。我个人建议使用后者。因为如果编写工具链文件，都需要通过命令行传递不同的架构参数，那还不如直接调用命令行传递所有参数。最后将所需要的命令行写在一个<code>generator.sh</code>脚本中。</p>
<p>因此对于 Android 这部分的配置放到命令行参数中：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-DCMAKE_SYSTEM_NAME=Android</span><br><span class="line">-DCMAKE_SYSTEM_VERSION=21</span><br><span class="line">-DCMAKE_ANDROID_ARCH_ABI=arm64-v8a</span><br><span class="line">-DCMAKE_ANDROID_NDK=/path/to/android-ndk</span><br><span class="line">-DCMAKE_ANDROID_STL_TYPE=none</span><br></pre></td></tr></table></figure>
<p>对于 <code>APP_CPPFLAGS</code>，可以通过 CMake
内建的配置而不是直接修改 <code>CMAKE_CXX_FLAGS</code>
来完成，这样可以防止其余编译参数被覆盖</p>
<p>编译参数 <code>-fno-exceptions</code> 和
<code>-fno-rtti</code>，CMake 提供了独立的配置选项
<code>CMAKE_ANDROID_RTTI</code> 和
<code>CMAKE_ANDROID_EXCEPTIONS</code>。默认情况下，CMake 会关闭
exceptions 和 rtti。不过最好还是显式的指定一下。（ndk
中的工具链文件对于这两个参数的的行为就和cmake 集成的行为不同，如果使用
ndk 的工具链文件，如果不指定 <code>CMAKE_ANDROID_RTTI=off</code> 和
<code>CMAKE_ANDROID_EXCEPTIONS=off</code>，编译时就不会添加
<code>-fno-exceptions</code> 和 <code>-fno-rtti</code>
编译参数）。<code>CMAKE_ANDROID_RTTI</code> 和
<code>CMAKE_ANDROID_EXCEPTIONS</code>
属于<code>控制构建的变量</code>，因此应该放到命令行参数中：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-DCMAKE_ANDROID_RTTI=off</span><br><span class="line">-DCMAKE_ANDROID_EXCEPTIONS=off</span><br></pre></td></tr></table></figure>
<p>编译参数 <code>-std=c++17</code>，可以通过设置
<code>CMAKE_CXX_STANDARD</code> 和 <code>CMAKE_CXX_EXTENSIONS</code>
来完成</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 对应 -std=c++17</span></span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_STANDARD <span class="number">17</span>)</span><br><span class="line"><span class="comment">#  如果 CMAKE_CXX_EXTENSIONS 为ON，则编译参数为 -std=gnu++17</span></span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_EXTENSIONS <span class="keyword">off</span>)</span><br></pre></td></tr></table></figure>
<p>编译参数 <code>-fvisibility=hidden</code> 和
<code>-fvisibility-inlines-hidden</code>，CMake 提供了对应的配置选项
<code>CMAKE_VISIBILITY_INLINES_HIDDEN</code> 和
<code>CMAKE_CXX_VISIBILITY_PRESET</code>:</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span>(CMAKE_VISIBILITY_INLINES_HIDDEN <span class="keyword">on</span>)</span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_VISIBILITY_PRESET hidden)</span><br></pre></td></tr></table></figure>
<h3 id="cstl">C++STL</h3>
<p>如果不使用 C++STL，则只需链接一下系统的 stdc++ 即可。（注意需要注释掉
example.cpp 中的 <code>#include &lt;cstdlib&gt;</code> 这一行）。</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">target_link_libraries</span>(example log stdc++)</span><br></pre></td></tr></table></figure>
<p>如果需要使用 C++STL，则情况稍微复杂一些。首先 zygisk-module-samble
使用的 cxx 是经过作者修改过的 <a target="_blank" rel="noopener" href="https://github.com/topjohnwu/libcxx.git">llvm-libcxx</a>，转为
Android 设计，移除了对异常和RTTI的支持。编译方式也从 cmake 改为了
ndk-build。</p>
<h4 id="使用预编译-libcxx">使用预编译 libcxx</h4>
<p>比较简单的一种方法是将该 libcxx 先用 ndk-build
编译成静态库，然后再链接到 zygisk 模块中。在原始的
<code>zygisk-module-sample/module</code> 文件夹中执行
<code>ndk-build</code> 后，在
<code>zygisk-module-sample/module/obj/local/&lt;arch&gt;/</code>
目下会生成 <code>libcxx.a</code>。将其复制到某个 lib
目录（可以在项目中如 libs，也可以是外部目录），然后使用
<code>link_libraries</code> 制定链接目录，再链接 libcxx 。之后将
<code>zygisk-module-sample/module/jni/libcxx/include</code> 和
<code>zygis-module-sample/module/jni/libcxx/src</code> 目录复制到某个
include 目录（可以在项目中如 include，也可以是外部的全局目录），然后使用
<code>include_directories</code> 指定 include 目录。注意需要在
<code>link_libraries</code> 和 <code>include_directories</code> 之后创建
target 才能链接成功。</p>
<p>假设外部的 libcxx 目录结构如下 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">/path/to/libcxx</span><br><span class="line">    ├── include</span><br><span class="line">    │   ├── ...</span><br><span class="line">    │   └── wctype.h</span><br><span class="line">    ├── src</span><br><span class="line">    │   ├── ...</span><br><span class="line">    │   └── verbose_abort.cpp</span><br><span class="line">    ├── libs</span><br><span class="line">    │   ├── armeabi-v7a</span><br><span class="line">    │   │   └── libcxx.a</span><br><span class="line">    │   ├── arm64-v8a</span><br><span class="line">    │   │   └── libcxx.a</span><br><span class="line">    │   ├── x86</span><br><span class="line">    │   │   └── libcxx.a</span><br><span class="line">    │   └── x86_64</span><br><span class="line">    │       └── libcxx.a</span><br><span class="line">    └── Android.mk</span><br></pre></td></tr></table></figure></p>
<p>则可以使用如下的 CMakeLists.txt 配置包含目录和链接目录：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ...</span></span><br><span class="line"><span class="comment"># use prebuilt libcxx.a</span></span><br><span class="line"><span class="keyword">set</span>(LIBCXX_PATH <span class="string">&quot;/path/to/libcxx&quot;</span>)</span><br><span class="line"><span class="keyword">include_directories</span>(<span class="variable">$&#123;LIBCXX_PATH&#125;</span>/<span class="keyword">include</span>)</span><br><span class="line"><span class="keyword">include_directories</span>(<span class="variable">$&#123;LIBCXX_PATH&#125;</span>/src)</span><br><span class="line"><span class="keyword">link_directories</span>(<span class="variable">$&#123;LIBCXX_PATH&#125;</span>/libs/<span class="variable">$&#123;CMAKE_ANDROID_ARCH_ABI&#125;</span>)</span><br></pre></td></tr></table></figure>
<h4 id="使用-libcxx-源码">使用 libcxx 源码</h4>
<p>你也可以像 zygisk-module-sample 一样，直接将 libcxx
的源码放到项目中。这样做的好处是无需做额外的配置即可直接编译。但是这样做的缺点是编译时间会变长。</p>
<p>topjohnwu 的 libcxx 项目只配置了 <code>ndk-build</code>
的配置文件，并未适配 <code>CMake</code>。项目中的
<code>CMakeLists.txt</code> 文件原自
<code>llvm-project</code>（作为<code>llvm-project</code>），不能直接用
<code>add_subdirectory</code> 添加进来，需要对
<code>CMakeLists.txt</code> 进行修改，更改一些配置。改原版 libcxx 的
<code>CMakeLists.txt</code> 难度较大，不如直接将 <code>Android.mk</code>
翻译成 <code>CMakeLists.txt</code>。<code>Android.mk</code>
其实非常简单粗暴，直接设定源文件、头文件、编译参数、链接参数等，没有任何复杂的逻辑。因此翻译成
<code>CMakeLists.txt</code>
也比较简单，也是设定源文件、头文件、编译参数。翻译后的
<code>CMakeLists.txt</code> 如下，删除了几个 CMake
默认会添加的编译参数:</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.13</span>.<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_STANDARD <span class="number">20</span>)</span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_EXTENSIONS <span class="keyword">off</span>)</span><br><span class="line"><span class="keyword">set</span>(CMAKE_VISIBILITY_INLINES_HIDDEN <span class="keyword">on</span>)</span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_VISIBILITY_PRESET hidden)</span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span>(libcxx_includes</span><br><span class="line">    <span class="keyword">include</span></span><br><span class="line">    src</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span>(libcxx_sources</span><br><span class="line">    src/algorithm.cpp</span><br><span class="line">    src/any.cpp</span><br><span class="line">    src/atomic.cpp</span><br><span class="line">    src/barrier.cpp</span><br><span class="line">    src/bind.cpp</span><br><span class="line">    src/charconv.cpp</span><br><span class="line">    src/chrono.cpp</span><br><span class="line">    src/condition_variable.cpp</span><br><span class="line">    src/condition_variable_destructor.cpp</span><br><span class="line">    src/debug.cpp</span><br><span class="line">    src/exception.cpp</span><br><span class="line">    src/filesystem/directory_iterator.cpp</span><br><span class="line">    src/filesystem/int128_builtins.cpp</span><br><span class="line">    src/filesystem/operations.cpp</span><br><span class="line">    src/functional.cpp</span><br><span class="line">    src/future.cpp</span><br><span class="line">    src/hash.cpp</span><br><span class="line">    src/ios.cpp</span><br><span class="line">    src/ios.instantiations.cpp</span><br><span class="line">    src/iostream.cpp</span><br><span class="line">    src/legacy_debug_handler.cpp</span><br><span class="line">    src/legacy_pointer_safety.cpp</span><br><span class="line">    src/locale.cpp</span><br><span class="line">    src/memory.cpp</span><br><span class="line">    src/mutex.cpp</span><br><span class="line">    src/mutex_destructor.cpp</span><br><span class="line">    src/new.cpp</span><br><span class="line">    src/optional.cpp</span><br><span class="line">    src/random_shuffle.cpp</span><br><span class="line">    src/random.cpp</span><br><span class="line">    src/regex.cpp</span><br><span class="line">    src/shared_mutex.cpp</span><br><span class="line">    src/stdexcept.cpp</span><br><span class="line">    src/<span class="keyword">string</span>.cpp</span><br><span class="line">    src/strstream.cpp</span><br><span class="line">    src/system_error.cpp</span><br><span class="line">    src/thread.cpp</span><br><span class="line">    src/typeinfo.cpp</span><br><span class="line">    src/utility.cpp</span><br><span class="line">    src/valarray.cpp</span><br><span class="line">    src/variant.cpp</span><br><span class="line">    src/vector.cpp</span><br><span class="line">    src/verbose_abort.cpp</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span>(libcxx_cxxflags <span class="string">&quot;-fvisibility-global-new-delete-hidden -DLIBCXX_BUILDING_LIBCXXABI -D_LIBCPP_NO_EXCEPTIONS -D_LIBCPP_NO_RTTI -D_LIBCPP_BUILDING_LIBRARY -D_LIBCPP_DISABLE_VISIBILITY_ANNOTATIONS -D__STDC_FORMAT_MACROS&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span>(libcxxabi_src_files</span><br><span class="line">    src/abi/abort_message.cpp</span><br><span class="line">    src/abi/cxa_aux_runtime.cpp</span><br><span class="line">    src/abi/cxa_default_handlers.cpp</span><br><span class="line">    src/abi/cxa_exception_storage.cpp</span><br><span class="line">    src/abi/cxa_guard.cpp</span><br><span class="line">    src/abi/cxa_handlers.cpp</span><br><span class="line">    src/abi/cxa_noexception.cpp</span><br><span class="line">    src/abi/cxa_thread_atexit.cpp</span><br><span class="line">    src/abi/cxa_vector.cpp</span><br><span class="line">    src/abi/cxa_virtual.cpp</span><br><span class="line">    src/abi/stdlib_exception.cpp</span><br><span class="line">    src/abi/stdlib_new_delete.cpp</span><br><span class="line">    src/abi/stdlib_stdexcept.cpp</span><br><span class="line">    src/abi/stdlib_typeinfo.cpp</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span>(libcxxabi_includes</span><br><span class="line">    <span class="keyword">include</span></span><br><span class="line">    <span class="keyword">include</span>/abi</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span>(libcxxabi_cflags</span><br><span class="line">    -D__STDC_FORMAT_MACROS</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span>(libcxxabi_cppflags <span class="string">&quot;-D_LIBCXXABI_NO_EXCEPTIONS -Wno-macro-redefined -Wno-unknown-attributes -DHAS_THREAD_LOCAL&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">include_directories</span>(<span class="variable">$&#123;libcxx_includes&#125;</span>)</span><br><span class="line"><span class="keyword">include_directories</span>(<span class="variable">$&#123;libcxxabi_includes&#125;</span>)</span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_FLAGS <span class="string">&quot;$&#123;libcxx_cxxflags&#125; $&#123;libcxxabi_cppflags&#125; $&#123;CMAKE_CXX_FLAGS&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">add_library</span>(cxx STATIC <span class="variable">$&#123;libcxx_sources&#125;</span> <span class="variable">$&#123;libcxxabi_src_files&#125;</span>)</span><br></pre></td></tr></table></figure>
<p>修改后，使用 <code>add_subdirectory</code> 添加，注意还需要使用
<code>include_directories</code> 设置 <code>libcxx</code>
的头文件目录。</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">add_subdirectory</span>(libcxx)</span><br><span class="line"><span class="keyword">include_directories</span>(libcxx/<span class="keyword">include</span>)</span><br><span class="line"><span class="keyword">include_directories</span>(libcxx/<span class="keyword">include</span>/src)</span><br></pre></td></tr></table></figure>
<h3 id="总结">总结</h3>
<p>最终的 <code>CMakeLists.txt</code> 如下：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.26</span>)</span><br><span class="line"><span class="keyword">project</span>(zygisk_module_sample_cmake)</span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_STANDARD <span class="number">17</span>)</span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_EXTENSIONS <span class="keyword">off</span>)</span><br><span class="line"><span class="keyword">set</span>(CMAKE_VISIBILITY_INLINES_HIDDEN <span class="keyword">on</span>)</span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_VISIBILITY_PRESET hidden)</span><br><span class="line"></span><br><span class="line"><span class="comment"># use prebuilt libcxx.a</span></span><br><span class="line"><span class="comment">#set(LIBCXX_PATH &quot;/path/to/libcxx&quot;)</span></span><br><span class="line"><span class="comment">#include_directories($&#123;LIBCXX_PATH&#125;/include)</span></span><br><span class="line"><span class="comment">#include_directories($&#123;LIBCXX_PATH&#125;/src)</span></span><br><span class="line"><span class="comment">#link_directories($&#123;LIBCXX_PATH&#125;/libs/$&#123;CMAKE_ANDROID_ARCH_ABI&#125;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># build cxx source</span></span><br><span class="line"><span class="keyword">add_subdirectory</span>(libcxx)</span><br><span class="line"><span class="keyword">include_directories</span>(libcxx/<span class="keyword">include</span>)</span><br><span class="line"><span class="keyword">include_directories</span>(libcxx/<span class="keyword">include</span>/src)</span><br><span class="line"></span><br><span class="line"><span class="keyword">add_library</span>(example SHARED example.cpp)</span><br><span class="line"></span><br><span class="line"><span class="keyword">target_link_libraries</span>(example log cxx)</span><br></pre></td></tr></table></figure>
<p>编译单一架构：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cmake -G Ninja -B build -S . -DCMAKE_SYSTEM_NAME=Android -DCMAKE_SYSTEM_VERSION=21 -DCMAKE_ANDROID_ARCH_ABI=arm64-v8a -DCMAKE_ANDROID_NDK=&quot;$&#123;ANDROID_NDK_HOME&#125;&quot; -DCMAKE_ANDROID_STL_TYPE=none -DCMAKE_ANDROID_RTTI=off -DCMAKE_ANDROID_EXCEPTIONS=off</span><br><span class="line">cmake --build build -j $(nproc)</span><br></pre></td></tr></table></figure>
<p>使用脚本编译多个架构：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/usr/bin/env sh</span></span><br><span class="line">TARGETS=&quot;armeabi-v7a arm64-v8a x86 x86_64&quot;</span><br><span class="line"></span><br><span class="line">for TARGET in $&#123;TARGETS&#125;</span><br><span class="line">do</span><br><span class="line">  echo &quot;build/$&#123;TARGET&#125;&quot;</span><br><span class="line">    # create one build dir per target architecture</span><br><span class="line">    mkdir -p &quot;build/$&#123;TARGET&#125;&quot;</span><br><span class="line"></span><br><span class="line">    cmake -G Ninja -B &quot;build/$&#123;TARGET&#125;&quot; -S . -DCMAKE_SYSTEM_NAME=Android -DCMAKE_SYSTEM_VERSION=21 -DCMAKE_ANDROID_ARCH_ABI=&quot;$&#123;TARGET&#125;&quot; -DCMAKE_ANDROID_NDK=&quot;$&#123;ANDROID_NDK_HOME&#125;&quot; -DCMAKE_ANDROID_STL_TYPE=none -DCMAKE_ANDROID_RTTI=off -DCMAKE_ANDROID_EXCEPTIONS=off -DCMAKE_BUILD_TYPE=Release</span><br><span class="line"></span><br><span class="line">    cmake --build &quot;build/$&#123;TARGET&#125;&quot; --config Release -j $(nproc)</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

    </div>

    
    
    

    <footer class="post-footer">
          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>本文作者： </strong>Apeng
  </li>
  <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="http://apeng.re/2023/09/21/zygisk-module-sample-cmake/" title="将 zygisk-module-sample 迁移至 cmake">http://apeng.re/2023/09/21/zygisk-module-sample-cmake/</a>
  </li>
  <li class="post-copyright-license">
      <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/deed.zh" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-ND</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

          <div class="post-tags">
              <a href="/tags/Android/" rel="tag"># Android</a>
              <a href="/tags/zygisk/" rel="tag"># zygisk</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2022/07/04/2022googlectf/" rel="prev" title="2022 Google CTF Reverse - ELDAR writeup">
                  <i class="fa fa-angle-left"></i> 2022 Google CTF Reverse - ELDAR writeup
                </a>
            </div>
            <div class="post-nav-item">
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2023</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Apeng</span>
  </div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

  <a href="https://github.com/Apeng7364" class="github-corner" title="在 GitHub 上关注我" aria-label="在 GitHub 上关注我" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script>

  






  




  

  <script class="next-config" data-name="enableMath" type="application/json">false</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>



</body>
</html>
